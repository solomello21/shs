import{e as Mt,r as Ke,j as ge,h as et,i as Et}from"./client.b9f267ae.js";var xt=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var a={},y=Symbol("test"),g=Object(y);if(typeof y=="string"||Object.prototype.toString.call(y)!=="[object Symbol]"||Object.prototype.toString.call(g)!=="[object Symbol]")return!1;var v=42;a[y]=v;for(y in a)return!1;if(typeof Object.keys=="function"&&Object.keys(a).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(a).length!==0)return!1;var p=Object.getOwnPropertySymbols(a);if(p.length!==1||p[0]!==y||!Object.prototype.propertyIsEnumerable.call(a,y))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var h=Object.getOwnPropertyDescriptor(a,y);if(h.value!==v||h.enumerable!==!0)return!1}return!0},tt=typeof Symbol<"u"&&Symbol,_t=xt,kt=function(){return typeof tt!="function"||typeof Symbol!="function"||typeof tt("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:_t()},Ft="Function.prototype.bind called on incompatible ",Pe=Array.prototype.slice,It=Object.prototype.toString,Ht="[object Function]",$t=function(a){var y=this;if(typeof y!="function"||It.call(y)!==Ht)throw new TypeError(Ft+y);for(var g=Pe.call(arguments,1),v,p=function(){if(this instanceof v){var e=y.apply(this,g.concat(Pe.call(arguments)));return Object(e)===e?e:this}else return y.apply(a,g.concat(Pe.call(arguments)))},h=Math.max(0,y.length-g.length),t=[],i=0;i<h;i++)t.push("$"+i);if(v=Function("binder","return function ("+t.join(",")+"){ return binder.apply(this,arguments); }")(p),y.prototype){var r=function(){};r.prototype=y.prototype,v.prototype=new r,r.prototype=null}return v},qt=$t,Ve=Function.prototype.bind||qt,Nt=Ve,Ut=Nt.call(Function.call,Object.prototype.hasOwnProperty),w,ve=SyntaxError,yt=Function,ae=TypeError,Te=function(o){try{return yt('"use strict"; return ('+o+").constructor;")()}catch{}},ee=Object.getOwnPropertyDescriptor;if(ee)try{ee({},"")}catch{ee=null}var Le=function(){throw new ae},Wt=ee?function(){try{return arguments.callee,Le}catch{try{return ee(arguments,"callee").get}catch{return Le}}}():Le,ie=kt(),j=Object.getPrototypeOf||function(o){return o.__proto__},ne={},Yt=typeof Uint8Array>"u"?w:j(Uint8Array),se={"%AggregateError%":typeof AggregateError>"u"?w:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?w:ArrayBuffer,"%ArrayIteratorPrototype%":ie?j([][Symbol.iterator]()):w,"%AsyncFromSyncIteratorPrototype%":w,"%AsyncFunction%":ne,"%AsyncGenerator%":ne,"%AsyncGeneratorFunction%":ne,"%AsyncIteratorPrototype%":ne,"%Atomics%":typeof Atomics>"u"?w:Atomics,"%BigInt%":typeof BigInt>"u"?w:BigInt,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?w:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?w:Float32Array,"%Float64Array%":typeof Float64Array>"u"?w:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?w:FinalizationRegistry,"%Function%":yt,"%GeneratorFunction%":ne,"%Int8Array%":typeof Int8Array>"u"?w:Int8Array,"%Int16Array%":typeof Int16Array>"u"?w:Int16Array,"%Int32Array%":typeof Int32Array>"u"?w:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":ie?j(j([][Symbol.iterator]())):w,"%JSON%":typeof JSON=="object"?JSON:w,"%Map%":typeof Map>"u"?w:Map,"%MapIteratorPrototype%":typeof Map>"u"||!ie?w:j(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?w:Promise,"%Proxy%":typeof Proxy>"u"?w:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?w:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?w:Set,"%SetIteratorPrototype%":typeof Set>"u"||!ie?w:j(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?w:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":ie?j(""[Symbol.iterator]()):w,"%Symbol%":ie?Symbol:w,"%SyntaxError%":ve,"%ThrowTypeError%":Wt,"%TypedArray%":Yt,"%TypeError%":ae,"%Uint8Array%":typeof Uint8Array>"u"?w:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?w:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?w:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?w:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?w:WeakMap,"%WeakRef%":typeof WeakRef>"u"?w:WeakRef,"%WeakSet%":typeof WeakSet>"u"?w:WeakSet},Vt=function o(a){var y;if(a==="%AsyncFunction%")y=Te("async function () {}");else if(a==="%GeneratorFunction%")y=Te("function* () {}");else if(a==="%AsyncGeneratorFunction%")y=Te("async function* () {}");else if(a==="%AsyncGenerator%"){var g=o("%AsyncGeneratorFunction%");g&&(y=g.prototype)}else if(a==="%AsyncIteratorPrototype%"){var v=o("%AsyncGenerator%");v&&(y=j(v.prototype))}return se[a]=y,y},rt={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Ae=Ve,Se=Ut,jt=Ae.call(Function.call,Array.prototype.concat),zt=Ae.call(Function.apply,Array.prototype.splice),it=Ae.call(Function.call,String.prototype.replace),Be=Ae.call(Function.call,String.prototype.slice),Zt=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Gt=/\\(\\)?/g,Jt=function(a){var y=Be(a,0,1),g=Be(a,-1);if(y==="%"&&g!=="%")throw new ve("invalid intrinsic syntax, expected closing `%`");if(g==="%"&&y!=="%")throw new ve("invalid intrinsic syntax, expected opening `%`");var v=[];return it(a,Zt,function(p,h,t,i){v[v.length]=t?it(i,Gt,"$1"):h||p}),v},Xt=function(a,y){var g=a,v;if(Se(rt,g)&&(v=rt[g],g="%"+v[0]+"%"),Se(se,g)){var p=se[g];if(p===ne&&(p=Vt(g)),typeof p>"u"&&!y)throw new ae("intrinsic "+a+" exists, but is not available. Please file an issue!");return{alias:v,name:g,value:p}}throw new ve("intrinsic "+a+" does not exist!")},je=function(a,y){if(typeof a!="string"||a.length===0)throw new ae("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof y!="boolean")throw new ae('"allowMissing" argument must be a boolean');var g=Jt(a),v=g.length>0?g[0]:"",p=Xt("%"+v+"%",y),h=p.name,t=p.value,i=!1,r=p.alias;r&&(v=r[0],zt(g,jt([0,1],r)));for(var e=1,s=!0;e<g.length;e+=1){var n=g[e],d=Be(n,0,1),f=Be(n,-1);if((d==='"'||d==="'"||d==="`"||f==='"'||f==="'"||f==="`")&&d!==f)throw new ve("property names with quotes must have matching quotes");if((n==="constructor"||!s)&&(i=!0),v+="."+n,h="%"+v+"%",Se(se,h))t=se[h];else if(t!=null){if(!(n in t)){if(!y)throw new ae("base intrinsic for "+a+" exists, but the property is not available.");return}if(ee&&e+1>=g.length){var u=ee(t,n);s=!!u,s&&"get"in u&&!("originalValue"in u.get)?t=u.get:t=t[n]}else s=Se(t,n),t=t[n];s&&!i&&(se[h]=t)}}return t},gt={exports:{}};(function(o){var a=Ve,y=je,g=y("%Function.prototype.apply%"),v=y("%Function.prototype.call%"),p=y("%Reflect.apply%",!0)||a.call(v,g),h=y("%Object.getOwnPropertyDescriptor%",!0),t=y("%Object.defineProperty%",!0),i=y("%Math.max%");if(t)try{t({},"a",{value:1})}catch{t=null}o.exports=function(s){var n=p(a,v,arguments);if(h&&t){var d=h(n,"length");d.configurable&&t(n,"length",{value:1+i(0,s.length-(arguments.length-1))})}return n};var r=function(){return p(a,g,arguments)};t?t(o.exports,"apply",{value:r}):o.exports.apply=r})(gt);var ht=je,pt=gt.exports,Qt=pt(ht("String.prototype.indexOf")),Kt=function(a,y){var g=ht(a,!!y);return typeof g=="function"&&Qt(a,".prototype.")>-1?pt(g):g};const er={},tr=Object.freeze(Object.defineProperty({__proto__:null,default:er},Symbol.toStringTag,{value:"Module"})),rr=Mt(tr);var ze=typeof Map=="function"&&Map.prototype,De=Object.getOwnPropertyDescriptor&&ze?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Oe=ze&&De&&typeof De.get=="function"?De.get:null,ir=ze&&Map.prototype.forEach,Ze=typeof Set=="function"&&Set.prototype,Me=Object.getOwnPropertyDescriptor&&Ze?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,we=Ze&&Me&&typeof Me.get=="function"?Me.get:null,nr=Ze&&Set.prototype.forEach,ar=typeof WeakMap=="function"&&WeakMap.prototype,he=ar?WeakMap.prototype.has:null,sr=typeof WeakSet=="function"&&WeakSet.prototype,pe=sr?WeakSet.prototype.has:null,or=typeof WeakRef=="function"&&WeakRef.prototype,nt=or?WeakRef.prototype.deref:null,ur=Boolean.prototype.valueOf,lr=Object.prototype.toString,cr=Function.prototype.toString,fr=String.prototype.match,Ge=String.prototype.slice,Z=String.prototype.replace,dr=String.prototype.toUpperCase,at=String.prototype.toLowerCase,mt=RegExp.prototype.test,st=Array.prototype.concat,U=Array.prototype.join,yr=Array.prototype.slice,ot=Math.floor,$e=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Ee=Object.getOwnPropertySymbols,qe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,oe=typeof Symbol=="function"&&typeof Symbol.iterator=="object",I=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===oe?"object":"symbol")?Symbol.toStringTag:null,vt=Object.prototype.propertyIsEnumerable,ut=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(o){return o.__proto__}:null);function lt(o,a){if(o===1/0||o===-1/0||o!==o||o&&o>-1e3&&o<1e3||mt.call(/e/,a))return a;var y=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof o=="number"){var g=o<0?-ot(-o):ot(o);if(g!==o){var v=String(g),p=Ge.call(a,v.length+1);return Z.call(v,y,"$&_")+"."+Z.call(Z.call(p,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Z.call(a,y,"$&_")}var xe=rr.custom,_e=xe&&Rt(xe)?xe:null,gr=function o(a,y,g,v){var p=y||{};if(z(p,"quoteStyle")&&p.quoteStyle!=="single"&&p.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(z(p,"maxStringLength")&&(typeof p.maxStringLength=="number"?p.maxStringLength<0&&p.maxStringLength!==1/0:p.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var h=z(p,"customInspect")?p.customInspect:!0;if(typeof h!="boolean"&&h!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(z(p,"indent")&&p.indent!==null&&p.indent!=="	"&&!(parseInt(p.indent,10)===p.indent&&p.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(z(p,"numericSeparator")&&typeof p.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var t=p.numericSeparator;if(typeof a>"u")return"undefined";if(a===null)return"null";if(typeof a=="boolean")return a?"true":"false";if(typeof a=="string")return St(a,p);if(typeof a=="number"){if(a===0)return 1/0/a>0?"0":"-0";var i=String(a);return t?lt(a,i):i}if(typeof a=="bigint"){var r=String(a)+"n";return t?lt(a,r):r}var e=typeof p.depth>"u"?5:p.depth;if(typeof g>"u"&&(g=0),g>=e&&e>0&&typeof a=="object")return Ne(a)?"[Array]":"[Object]";var s=xr(p,g);if(typeof v>"u")v=[];else if(Ct(v,a)>=0)return"[Circular]";function n(O,R,T){if(R&&(v=yr.call(v),v.push(R)),T){var D={depth:p.depth};return z(p,"quoteStyle")&&(D.quoteStyle=p.quoteStyle),o(O,D,g+1,v)}return o(O,p,g+1,v)}if(typeof a=="function"){var d=Or(a),f=be(a,n);return"[Function"+(d?": "+d:" (anonymous)")+"]"+(f.length>0?" { "+U.call(f,", ")+" }":"")}if(Rt(a)){var u=oe?Z.call(String(a),/^(Symbol\(.*\))_[^)]*$/,"$1"):qe.call(a);return typeof a=="object"&&!oe?ye(u):u}if(Dr(a)){for(var c="<"+at.call(String(a.nodeName)),l=a.attributes||[],m=0;m<l.length;m++)c+=" "+l[m].name+"="+bt(hr(l[m].value),"double",p);return c+=">",a.childNodes&&a.childNodes.length&&(c+="..."),c+="</"+at.call(String(a.nodeName))+">",c}if(Ne(a)){if(a.length===0)return"[]";var b=be(a,n);return s&&!Er(b)?"["+Ue(b,s)+"]":"[ "+U.call(b,", ")+" ]"}if(vr(a)){var A=be(a,n);return"cause"in a&&!vt.call(a,"cause")?"{ ["+String(a)+"] "+U.call(st.call("[cause]: "+n(a.cause),A),", ")+" }":A.length===0?"["+String(a)+"]":"{ ["+String(a)+"] "+U.call(A,", ")+" }"}if(typeof a=="object"&&h){if(_e&&typeof a[_e]=="function")return a[_e]();if(h!=="symbol"&&typeof a.inspect=="function")return a.inspect()}if(wr(a)){var S=[];return ir.call(a,function(O,R){S.push(n(R,a,!0)+" => "+n(O,a))}),ct("Map",Oe.call(a),S,s)}if(Tr(a)){var k=[];return nr.call(a,function(O){k.push(n(O,a))}),ct("Set",we.call(a),k,s)}if(Ar(a))return ke("WeakMap");if(Lr(a))return ke("WeakSet");if(Pr(a))return ke("WeakRef");if(Rr(a))return ye(n(Number(a)));if(Sr(a))return ye(n($e.call(a)));if(Cr(a))return ye(ur.call(a));if(br(a))return ye(n(String(a)));if(!pr(a)&&!mr(a)){var x=be(a,n),F=ut?ut(a)===Object.prototype:a instanceof Object||a.constructor===Object,C=a instanceof Object?"":"null prototype",$=!F&&I&&Object(a)===a&&I in a?Ge.call(G(a),8,-1):C?"Object":"",P=F||typeof a.constructor!="function"?"":a.constructor.name?a.constructor.name+" ":"",B=P+($||C?"["+U.call(st.call([],$||[],C||[]),": ")+"] ":"");return x.length===0?B+"{}":s?B+"{"+Ue(x,s)+"}":B+"{ "+U.call(x,", ")+" }"}return String(a)};function bt(o,a,y){var g=(y.quoteStyle||a)==="double"?'"':"'";return g+o+g}function hr(o){return Z.call(String(o),/"/g,"&quot;")}function Ne(o){return G(o)==="[object Array]"&&(!I||!(typeof o=="object"&&I in o))}function pr(o){return G(o)==="[object Date]"&&(!I||!(typeof o=="object"&&I in o))}function mr(o){return G(o)==="[object RegExp]"&&(!I||!(typeof o=="object"&&I in o))}function vr(o){return G(o)==="[object Error]"&&(!I||!(typeof o=="object"&&I in o))}function br(o){return G(o)==="[object String]"&&(!I||!(typeof o=="object"&&I in o))}function Rr(o){return G(o)==="[object Number]"&&(!I||!(typeof o=="object"&&I in o))}function Cr(o){return G(o)==="[object Boolean]"&&(!I||!(typeof o=="object"&&I in o))}function Rt(o){if(oe)return o&&typeof o=="object"&&o instanceof Symbol;if(typeof o=="symbol")return!0;if(!o||typeof o!="object"||!qe)return!1;try{return qe.call(o),!0}catch{}return!1}function Sr(o){if(!o||typeof o!="object"||!$e)return!1;try{return $e.call(o),!0}catch{}return!1}var Br=Object.prototype.hasOwnProperty||function(o){return o in this};function z(o,a){return Br.call(o,a)}function G(o){return lr.call(o)}function Or(o){if(o.name)return o.name;var a=fr.call(cr.call(o),/^function\s*([\w$]+)/);return a?a[1]:null}function Ct(o,a){if(o.indexOf)return o.indexOf(a);for(var y=0,g=o.length;y<g;y++)if(o[y]===a)return y;return-1}function wr(o){if(!Oe||!o||typeof o!="object")return!1;try{Oe.call(o);try{we.call(o)}catch{return!0}return o instanceof Map}catch{}return!1}function Ar(o){if(!he||!o||typeof o!="object")return!1;try{he.call(o,he);try{pe.call(o,pe)}catch{return!0}return o instanceof WeakMap}catch{}return!1}function Pr(o){if(!nt||!o||typeof o!="object")return!1;try{return nt.call(o),!0}catch{}return!1}function Tr(o){if(!we||!o||typeof o!="object")return!1;try{we.call(o);try{Oe.call(o)}catch{return!0}return o instanceof Set}catch{}return!1}function Lr(o){if(!pe||!o||typeof o!="object")return!1;try{pe.call(o,pe);try{he.call(o,he)}catch{return!0}return o instanceof WeakSet}catch{}return!1}function Dr(o){return!o||typeof o!="object"?!1:typeof HTMLElement<"u"&&o instanceof HTMLElement?!0:typeof o.nodeName=="string"&&typeof o.getAttribute=="function"}function St(o,a){if(o.length>a.maxStringLength){var y=o.length-a.maxStringLength,g="... "+y+" more character"+(y>1?"s":"");return St(Ge.call(o,0,a.maxStringLength),a)+g}var v=Z.call(Z.call(o,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Mr);return bt(v,"single",a)}function Mr(o){var a=o.charCodeAt(0),y={8:"b",9:"t",10:"n",12:"f",13:"r"}[a];return y?"\\"+y:"\\x"+(a<16?"0":"")+dr.call(a.toString(16))}function ye(o){return"Object("+o+")"}function ke(o){return o+" { ? }"}function ct(o,a,y,g){var v=g?Ue(y,g):U.call(y,", ");return o+" ("+a+") {"+v+"}"}function Er(o){for(var a=0;a<o.length;a++)if(Ct(o[a],`
`)>=0)return!1;return!0}function xr(o,a){var y;if(o.indent==="	")y="	";else if(typeof o.indent=="number"&&o.indent>0)y=U.call(Array(o.indent+1)," ");else return null;return{base:y,prev:U.call(Array(a+1),y)}}function Ue(o,a){if(o.length===0)return"";var y=`
`+a.prev+a.base;return y+U.call(o,","+y)+`
`+a.prev}function be(o,a){var y=Ne(o),g=[];if(y){g.length=o.length;for(var v=0;v<o.length;v++)g[v]=z(o,v)?a(o[v],o):""}var p=typeof Ee=="function"?Ee(o):[],h;if(oe){h={};for(var t=0;t<p.length;t++)h["$"+p[t]]=p[t]}for(var i in o)!z(o,i)||y&&String(Number(i))===i&&i<o.length||oe&&h["$"+i]instanceof Symbol||(mt.call(/[^\w$]/,i)?g.push(a(i,o)+": "+a(o[i],o)):g.push(i+": "+a(o[i],o)));if(typeof Ee=="function")for(var r=0;r<p.length;r++)vt.call(o,p[r])&&g.push("["+a(p[r])+"]: "+a(o[p[r]],o));return g}var Je=je,le=Kt,_r=gr,kr=Je("%TypeError%"),Re=Je("%WeakMap%",!0),Ce=Je("%Map%",!0),Fr=le("WeakMap.prototype.get",!0),Ir=le("WeakMap.prototype.set",!0),Hr=le("WeakMap.prototype.has",!0),$r=le("Map.prototype.get",!0),qr=le("Map.prototype.set",!0),Nr=le("Map.prototype.has",!0),Xe=function(o,a){for(var y=o,g;(g=y.next)!==null;y=g)if(g.key===a)return y.next=g.next,g.next=o.next,o.next=g,g},Ur=function(o,a){var y=Xe(o,a);return y&&y.value},Wr=function(o,a,y){var g=Xe(o,a);g?g.value=y:o.next={key:a,next:o.next,value:y}},Yr=function(o,a){return!!Xe(o,a)},Vr=function(){var a,y,g,v={assert:function(p){if(!v.has(p))throw new kr("Side channel does not contain "+_r(p))},get:function(p){if(Re&&p&&(typeof p=="object"||typeof p=="function")){if(a)return Fr(a,p)}else if(Ce){if(y)return $r(y,p)}else if(g)return Ur(g,p)},has:function(p){if(Re&&p&&(typeof p=="object"||typeof p=="function")){if(a)return Hr(a,p)}else if(Ce){if(y)return Nr(y,p)}else if(g)return Yr(g,p);return!1},set:function(p,h){Re&&p&&(typeof p=="object"||typeof p=="function")?(a||(a=new Re),Ir(a,p,h)):Ce?(y||(y=new Ce),qr(y,p,h)):(g||(g={key:{},next:null}),Wr(g,p,h))}};return v},jr=String.prototype.replace,zr=/%20/g,Fe={RFC1738:"RFC1738",RFC3986:"RFC3986"},Qe={default:Fe.RFC3986,formatters:{RFC1738:function(o){return jr.call(o,zr,"+")},RFC3986:function(o){return String(o)}},RFC1738:Fe.RFC1738,RFC3986:Fe.RFC3986},Zr=Qe,Ie=Object.prototype.hasOwnProperty,Q=Array.isArray,N=function(){for(var o=[],a=0;a<256;++a)o.push("%"+((a<16?"0":"")+a.toString(16)).toUpperCase());return o}(),Gr=function(a){for(;a.length>1;){var y=a.pop(),g=y.obj[y.prop];if(Q(g)){for(var v=[],p=0;p<g.length;++p)typeof g[p]<"u"&&v.push(g[p]);y.obj[y.prop]=v}}},Bt=function(a,y){for(var g=y&&y.plainObjects?Object.create(null):{},v=0;v<a.length;++v)typeof a[v]<"u"&&(g[v]=a[v]);return g},Jr=function o(a,y,g){if(!y)return a;if(typeof y!="object"){if(Q(a))a.push(y);else if(a&&typeof a=="object")(g&&(g.plainObjects||g.allowPrototypes)||!Ie.call(Object.prototype,y))&&(a[y]=!0);else return[a,y];return a}if(!a||typeof a!="object")return[a].concat(y);var v=a;return Q(a)&&!Q(y)&&(v=Bt(a,g)),Q(a)&&Q(y)?(y.forEach(function(p,h){if(Ie.call(a,h)){var t=a[h];t&&typeof t=="object"&&p&&typeof p=="object"?a[h]=o(t,p,g):a.push(p)}else a[h]=p}),a):Object.keys(y).reduce(function(p,h){var t=y[h];return Ie.call(p,h)?p[h]=o(p[h],t,g):p[h]=t,p},v)},Xr=function(a,y){return Object.keys(y).reduce(function(g,v){return g[v]=y[v],g},a)},Qr=function(o,a,y){var g=o.replace(/\+/g," ");if(y==="iso-8859-1")return g.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(g)}catch{return g}},Kr=function(a,y,g,v,p){if(a.length===0)return a;var h=a;if(typeof a=="symbol"?h=Symbol.prototype.toString.call(a):typeof a!="string"&&(h=String(a)),g==="iso-8859-1")return escape(h).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});for(var t="",i=0;i<h.length;++i){var r=h.charCodeAt(i);if(r===45||r===46||r===95||r===126||r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||p===Zr.RFC1738&&(r===40||r===41)){t+=h.charAt(i);continue}if(r<128){t=t+N[r];continue}if(r<2048){t=t+(N[192|r>>6]+N[128|r&63]);continue}if(r<55296||r>=57344){t=t+(N[224|r>>12]+N[128|r>>6&63]+N[128|r&63]);continue}i+=1,r=65536+((r&1023)<<10|h.charCodeAt(i)&1023),t+=N[240|r>>18]+N[128|r>>12&63]+N[128|r>>6&63]+N[128|r&63]}return t},ei=function(a){for(var y=[{obj:{o:a},prop:"o"}],g=[],v=0;v<y.length;++v)for(var p=y[v],h=p.obj[p.prop],t=Object.keys(h),i=0;i<t.length;++i){var r=t[i],e=h[r];typeof e=="object"&&e!==null&&g.indexOf(e)===-1&&(y.push({obj:h,prop:r}),g.push(e))}return Gr(y),a},ti=function(a){return Object.prototype.toString.call(a)==="[object RegExp]"},ri=function(a){return!a||typeof a!="object"?!1:!!(a.constructor&&a.constructor.isBuffer&&a.constructor.isBuffer(a))},ii=function(a,y){return[].concat(a,y)},ni=function(a,y){if(Q(a)){for(var g=[],v=0;v<a.length;v+=1)g.push(y(a[v]));return g}return y(a)},Ot={arrayToObject:Bt,assign:Xr,combine:ii,compact:ei,decode:Qr,encode:Kr,isBuffer:ri,isRegExp:ti,maybeMap:ni,merge:Jr},wt=Vr,We=Ot,me=Qe,ai=Object.prototype.hasOwnProperty,ft={brackets:function(a){return a+"[]"},comma:"comma",indices:function(a,y){return a+"["+y+"]"},repeat:function(a){return a}},K=Array.isArray,si=String.prototype.split,oi=Array.prototype.push,At=function(o,a){oi.apply(o,K(a)?a:[a])},ui=Date.prototype.toISOString,dt=me.default,_={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:We.encode,encodeValuesOnly:!1,format:dt,formatter:me.formatters[dt],indices:!1,serializeDate:function(a){return ui.call(a)},skipNulls:!1,strictNullHandling:!1},li=function(a){return typeof a=="string"||typeof a=="number"||typeof a=="boolean"||typeof a=="symbol"||typeof a=="bigint"},He={},ci=function o(a,y,g,v,p,h,t,i,r,e,s,n,d,f,u){for(var c=a,l=u,m=0,b=!1;(l=l.get(He))!==void 0&&!b;){var A=l.get(a);if(m+=1,typeof A<"u"){if(A===m)throw new RangeError("Cyclic object value");b=!0}typeof l.get(He)>"u"&&(m=0)}if(typeof t=="function"?c=t(y,c):c instanceof Date?c=e(c):g==="comma"&&K(c)&&(c=We.maybeMap(c,function(M){return M instanceof Date?e(M):M})),c===null){if(v)return h&&!d?h(y,_.encoder,f,"key",s):y;c=""}if(li(c)||We.isBuffer(c)){if(h){var S=d?y:h(y,_.encoder,f,"key",s);if(g==="comma"&&d){for(var k=si.call(String(c),","),x="",F=0;F<k.length;++F)x+=(F===0?"":",")+n(h(k[F],_.encoder,f,"value",s));return[n(S)+"="+x]}return[n(S)+"="+n(h(c,_.encoder,f,"value",s))]}return[n(y)+"="+n(String(c))]}var C=[];if(typeof c>"u")return C;var $;if(g==="comma"&&K(c))$=[{value:c.length>0?c.join(",")||null:void 0}];else if(K(t))$=t;else{var P=Object.keys(c);$=i?P.sort(i):P}for(var B=0;B<$.length;++B){var O=$[B],R=typeof O=="object"&&typeof O.value<"u"?O.value:c[O];if(!(p&&R===null)){var T=K(c)?typeof g=="function"?g(y,O):y:y+(r?"."+O:"["+O+"]");u.set(a,m);var D=wt();D.set(He,u),At(C,o(R,T,g,v,p,h,t,i,r,e,s,n,d,f,D))}}return C},fi=function(a){if(!a)return _;if(a.encoder!==null&&typeof a.encoder<"u"&&typeof a.encoder!="function")throw new TypeError("Encoder has to be a function.");var y=a.charset||_.charset;if(typeof a.charset<"u"&&a.charset!=="utf-8"&&a.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var g=me.default;if(typeof a.format<"u"){if(!ai.call(me.formatters,a.format))throw new TypeError("Unknown format option provided.");g=a.format}var v=me.formatters[g],p=_.filter;return(typeof a.filter=="function"||K(a.filter))&&(p=a.filter),{addQueryPrefix:typeof a.addQueryPrefix=="boolean"?a.addQueryPrefix:_.addQueryPrefix,allowDots:typeof a.allowDots>"u"?_.allowDots:!!a.allowDots,charset:y,charsetSentinel:typeof a.charsetSentinel=="boolean"?a.charsetSentinel:_.charsetSentinel,delimiter:typeof a.delimiter>"u"?_.delimiter:a.delimiter,encode:typeof a.encode=="boolean"?a.encode:_.encode,encoder:typeof a.encoder=="function"?a.encoder:_.encoder,encodeValuesOnly:typeof a.encodeValuesOnly=="boolean"?a.encodeValuesOnly:_.encodeValuesOnly,filter:p,format:g,formatter:v,serializeDate:typeof a.serializeDate=="function"?a.serializeDate:_.serializeDate,skipNulls:typeof a.skipNulls=="boolean"?a.skipNulls:_.skipNulls,sort:typeof a.sort=="function"?a.sort:null,strictNullHandling:typeof a.strictNullHandling=="boolean"?a.strictNullHandling:_.strictNullHandling}},di=function(o,a){var y=o,g=fi(a),v,p;typeof g.filter=="function"?(p=g.filter,y=p("",y)):K(g.filter)&&(p=g.filter,v=p);var h=[];if(typeof y!="object"||y===null)return"";var t;a&&a.arrayFormat in ft?t=a.arrayFormat:a&&"indices"in a?t=a.indices?"indices":"repeat":t="indices";var i=ft[t];v||(v=Object.keys(y)),g.sort&&v.sort(g.sort);for(var r=wt(),e=0;e<v.length;++e){var s=v[e];g.skipNulls&&y[s]===null||At(h,ci(y[s],s,i,g.strictNullHandling,g.skipNulls,g.encode?g.encoder:null,g.filter,g.sort,g.allowDots,g.serializeDate,g.format,g.formatter,g.encodeValuesOnly,g.charset,r))}var n=h.join(g.delimiter),d=g.addQueryPrefix===!0?"?":"";return g.charsetSentinel&&(g.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),n.length>0?d+n:""},ue=Ot,Ye=Object.prototype.hasOwnProperty,yi=Array.isArray,E={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:ue.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},gi=function(o){return o.replace(/&#(\d+);/g,function(a,y){return String.fromCharCode(parseInt(y,10))})},Pt=function(o,a){return o&&typeof o=="string"&&a.comma&&o.indexOf(",")>-1?o.split(","):o},hi="utf8=%26%2310003%3B",pi="utf8=%E2%9C%93",mi=function(a,y){var g={},v=y.ignoreQueryPrefix?a.replace(/^\?/,""):a,p=y.parameterLimit===1/0?void 0:y.parameterLimit,h=v.split(y.delimiter,p),t=-1,i,r=y.charset;if(y.charsetSentinel)for(i=0;i<h.length;++i)h[i].indexOf("utf8=")===0&&(h[i]===pi?r="utf-8":h[i]===hi&&(r="iso-8859-1"),t=i,i=h.length);for(i=0;i<h.length;++i)if(i!==t){var e=h[i],s=e.indexOf("]="),n=s===-1?e.indexOf("="):s+1,d,f;n===-1?(d=y.decoder(e,E.decoder,r,"key"),f=y.strictNullHandling?null:""):(d=y.decoder(e.slice(0,n),E.decoder,r,"key"),f=ue.maybeMap(Pt(e.slice(n+1),y),function(u){return y.decoder(u,E.decoder,r,"value")})),f&&y.interpretNumericEntities&&r==="iso-8859-1"&&(f=gi(f)),e.indexOf("[]=")>-1&&(f=yi(f)?[f]:f),Ye.call(g,d)?g[d]=ue.combine(g[d],f):g[d]=f}return g},vi=function(o,a,y,g){for(var v=g?a:Pt(a,y),p=o.length-1;p>=0;--p){var h,t=o[p];if(t==="[]"&&y.parseArrays)h=[].concat(v);else{h=y.plainObjects?Object.create(null):{};var i=t.charAt(0)==="["&&t.charAt(t.length-1)==="]"?t.slice(1,-1):t,r=parseInt(i,10);!y.parseArrays&&i===""?h={0:v}:!isNaN(r)&&t!==i&&String(r)===i&&r>=0&&y.parseArrays&&r<=y.arrayLimit?(h=[],h[r]=v):i!=="__proto__"&&(h[i]=v)}v=h}return v},bi=function(a,y,g,v){if(!!a){var p=g.allowDots?a.replace(/\.([^.[]+)/g,"[$1]"):a,h=/(\[[^[\]]*])/,t=/(\[[^[\]]*])/g,i=g.depth>0&&h.exec(p),r=i?p.slice(0,i.index):p,e=[];if(r){if(!g.plainObjects&&Ye.call(Object.prototype,r)&&!g.allowPrototypes)return;e.push(r)}for(var s=0;g.depth>0&&(i=t.exec(p))!==null&&s<g.depth;){if(s+=1,!g.plainObjects&&Ye.call(Object.prototype,i[1].slice(1,-1))&&!g.allowPrototypes)return;e.push(i[1])}return i&&e.push("["+p.slice(i.index)+"]"),vi(e,y,g,v)}},Ri=function(a){if(!a)return E;if(a.decoder!==null&&a.decoder!==void 0&&typeof a.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof a.charset<"u"&&a.charset!=="utf-8"&&a.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var y=typeof a.charset>"u"?E.charset:a.charset;return{allowDots:typeof a.allowDots>"u"?E.allowDots:!!a.allowDots,allowPrototypes:typeof a.allowPrototypes=="boolean"?a.allowPrototypes:E.allowPrototypes,allowSparse:typeof a.allowSparse=="boolean"?a.allowSparse:E.allowSparse,arrayLimit:typeof a.arrayLimit=="number"?a.arrayLimit:E.arrayLimit,charset:y,charsetSentinel:typeof a.charsetSentinel=="boolean"?a.charsetSentinel:E.charsetSentinel,comma:typeof a.comma=="boolean"?a.comma:E.comma,decoder:typeof a.decoder=="function"?a.decoder:E.decoder,delimiter:typeof a.delimiter=="string"||ue.isRegExp(a.delimiter)?a.delimiter:E.delimiter,depth:typeof a.depth=="number"||a.depth===!1?+a.depth:E.depth,ignoreQueryPrefix:a.ignoreQueryPrefix===!0,interpretNumericEntities:typeof a.interpretNumericEntities=="boolean"?a.interpretNumericEntities:E.interpretNumericEntities,parameterLimit:typeof a.parameterLimit=="number"?a.parameterLimit:E.parameterLimit,parseArrays:a.parseArrays!==!1,plainObjects:typeof a.plainObjects=="boolean"?a.plainObjects:E.plainObjects,strictNullHandling:typeof a.strictNullHandling=="boolean"?a.strictNullHandling:E.strictNullHandling}},Ci=function(o,a){var y=Ri(a);if(o===""||o===null||typeof o>"u")return y.plainObjects?Object.create(null):{};for(var g=typeof o=="string"?mi(o,y):o,v=y.plainObjects?Object.create(null):{},p=Object.keys(g),h=0;h<p.length;++h){var t=p[h],i=bi(t,g[t],y,typeof o=="string");v=ue.merge(v,i,y)}return y.allowSparse===!0?v:ue.compact(v)},Si=di,Bi=Ci,Oi=Qe,wi={formats:Oi,parse:Bi,stringify:Si},Tt={exports:{}};(function(o,a){(function(y,g){o.exports=g()})(self,function(){return(()=>{var y={6509:(h,t,i)=>{i.r(t),i.d(t,{default:()=>r});const r=`// Ring buffer reader class declared in the same file as the node since presently native js imports aren't supported\r
// in worklet modules. There's probably a way with webpack bundling but just leaving it here for now. Actual node below.\r
class RingBufferReader {\r
  constructor(sharedArrayBuffer, type) {\r
    this.capacity = (sharedArrayBuffer.byteLength - 8) / type.BYTES_PER_ELEMENT;\r
    this.buf = sharedArrayBuffer;\r
    this.writePointer = new Uint32Array(this.buf, 0, 1);\r
    this.readPointer = new Uint32Array(this.buf, 4, 1);\r
    this.storage = new type(this.buf, 8, this.capacity);\r
  }\r
\r
  pop(elements) {\r
    const read = Atomics.load(this.readPointer, 0);\r
    const write = Atomics.load(this.writePointer, 0);\r
\r
    const availableToRead = this.availableRead(read, write);\r
\r
    if (availableToRead === 0) {\r
      return 0;\r
    }\r
\r
    // Allows circular writing to array. Usually only the first call to copy is called, but if we are near the end\r
    // of the array, the first copy writes up to the end, then the second copy writes the remainder at the start\r
    const howManyToRead = Math.min(availableToRead, elements.length);\r
    let sizeUpToEndOfArray = Math.min(this.capacity - read, howManyToRead);\r
    let sizeFromStartOfTheArrayOrZero = howManyToRead - sizeUpToEndOfArray;\r
\r
    this.copy(this.storage, read, elements, 0, sizeUpToEndOfArray);\r
    this.copy(this.storage, 0, elements, sizeUpToEndOfArray, sizeFromStartOfTheArrayOrZero);\r
\r
    const readPointerPositionAfterRead = (read + howManyToRead) % this.capacity;\r
    Atomics.store(this.readPointer, 0, readPointerPositionAfterRead);\r
\r
    return howManyToRead;\r
  }\r
\r
  isEmpty() {\r
    const readPosition = Atomics.load(this.readPointer, 0);\r
    const writePosition = Atomics.load(this.writePointer, 0);\r
\r
    return writePosition === readPosition;\r
  }\r
\r
  dequeue(byteArray) {\r
    if (this.isEmpty()) {\r
      return 0;\r
    }\r
    return this.pop(byteArray);\r
  }\r
\r
  availableRead(readPosition, writePosition) {\r
    if (writePosition > readPosition) {\r
      return writePosition - readPosition;\r
    } else {\r
      return writePosition + this.capacity - readPosition;\r
    }\r
  }\r
\r
  copy(input, inputOffset, output, outputOffset, size) {\r
    for (let i = 0; i < size; i++) {\r
      output[outputOffset + i] = input[inputOffset + i];\r
    }\r
  }\r
}\r
\r
// Plays audio from its audio queue shared array buffer. Also allows parameters to be changed via index.\r
// Currently parameter changes aren't used, but might be in the future. Current implementation supports gain, but\r
// for gameboy that is determined by the gameboy logic itself.\r
class RingBufferProcessor extends AudioWorkletProcessor {\r
  static get parameterDescriptors() {\r
    return [];\r
  }\r
\r
  constructor(options) {\r
    super(options);\r
\r
    const parameterIndexByteSize = 1;\r
    const parameterValueByteSize = 4;\r
    const arrayBufferSize = parameterIndexByteSize + parameterValueByteSize;\r
    this.rawStorage = new ArrayBuffer(arrayBufferSize);\r
    this.byteArray = new Uint8Array(this.rawStorage);\r
    this.dataView = new DataView(this.rawStorage);\r
\r
    this.interleaved = new Float32Array(128);\r
    this.amp = 1.0;\r
    this.parameterObject = { index: 0, value: 0 };\r
    const { audioQueue, paramQueue } = options.processorOptions;\r
    this.audioReadBuffer = new RingBufferReader(audioQueue, Float32Array);\r
    this.paramReadBuffer = new RingBufferReader(paramQueue, Uint8Array);\r
  }\r
\r
  dequeueParameterChange() {\r
    if (this.paramReadBuffer.isEmpty()) {\r
      return false;\r
    }\r
    this.paramReadBuffer.pop(this.byteArray);\r
    this.parameterObject.index = this.dataView.getUint8(0);\r
    this.parameterObject.value = this.dataView.getFloat32(1);\r
\r
    return true;\r
  }\r
\r
  process(inputs, outputs) {\r
    // Get any param changes\r
    if (this.dequeueParameterChange(this.parameterObject)) {\r
      console.log("param change: ", this.parameterObject.index, this.parameterObject.value);\r
      this.amp = this.parameterObject.value;\r
    }\r
\r
    this.audioReadBuffer.dequeue(this.interleaved);\r
\r
    for (var i = 0; i < 128; i++) {\r
      outputs[0][0][i] = this.amp * this.interleaved[i]\r
    }\r
\r
    return true;\r
  }\r
}\r
\r
registerProcessor('ring-buffer-processor', RingBufferProcessor);\r
`},5991:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.APU=void 0;const r=i(9145),e=i(8107),s=i(1710),n=i(6283),d=i(3893),f=i(3210);class u{constructor(){this.FrameSequencerInterval=r.CPU.OperatingHertz/u.FrameSequencerHertz,this.audioContext=new AudioContext({sampleRate:44100}),this.frameSequencerCycleCounter=0,this.cyclesPerSample=r.CPU.OperatingHertz/this.audioContext.sampleRate,this.sampleCycleCounter=0,this._isAudioEnabled=!1,this.frameSequencerStep=0,this.audioContext.suspend();try{SharedArrayBuffer}catch{console.log("%cAudio requires SharedArrayBuffer","font-family:sans-serif; font-size: 20px"),console.log("This emulator uses a SharedArrayBuffer for buffered audio on a separate thread. To use shared array buffer you must use https and add the following headers to your server:"),console.log(`%c'Cross-Origin-Opener-Policy': 'same-origin', 
'Cross-Origin-Embedder-Policy': 'require-corp'`,"font-family:monospace;")}this.ringBufferPlayer=new f.RingBufferPlayer(this.audioContext,1024),this.sound1=new e.Sound1,this.sound2=new s.Sound2,this.sound3=new d.Sound3,this.sound4=new n.Sound4}get isAudioEnabled(){return this._isAudioEnabled}enableSound(){this._isAudioEnabled=!0,this.audioContext.resume()}disableSound(){this._isAudioEnabled=!1,this.audioContext.suspend()}tick(l){this._isAudioEnabled&&(this.sound1.tick(l),this.sound2.tick(l),this.sound3.tick(l),this.sound4.tick(l),this.sampleCycleCounter+=l,this.sampleCycleCounter>=this.cyclesPerSample&&(this.sampleChannels(),this.sampleCycleCounter-=this.cyclesPerSample),this.frameSequencerCycleCounter+=l,this.frameSequencerCycleCounter>=this.FrameSequencerInterval&&(this.advanceFrameSequencer(),this.frameSequencerCycleCounter-=this.FrameSequencerInterval))}sampleChannels(){const l=(this.sound1.getSample()+this.sound2.getSample()+this.sound3.getSample()+this.sound4.getSample())/4;this.ringBufferPlayer.writeSample(l)}advanceFrameSequencer(){switch(this.frameSequencerStep){case 0:this.clockLength();break;case 2:this.clockLength(),this.clockSweep();break;case 4:this.clockLength();break;case 6:this.clockLength(),this.clockSweep();break;case 7:this.clockVolume()}this.frameSequencerStep++,this.frameSequencerStep===8&&(this.frameSequencerStep=0)}clockLength(){this.sound1.clockLength(),this.sound2.clockLength(),this.sound3.clockLength(),this.sound4.clockLength()}clockSweep(){this.sound1.clockSweep()}clockVolume(){this.sound1.clockVolume(),this.sound2.clockVolume(),this.sound4.clockVolume()}}t.APU=u,u.FrameSequencerHertz=512},7637:(h,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Enveloper=void 0,t.Enveloper=class{constructor(){this.envelopePeriodTimer=0}initializeTimer(i){this.envelopePeriodTimer=i}clockVolume(i,r){const{lengthOfEnvelopeStep:e,isEnvelopeRising:s}=r;if(e===0)return i;if(this.envelopePeriodTimer>0&&this.envelopePeriodTimer--,this.envelopePeriodTimer===0){if(this.envelopePeriodTimer=e,s&&i<15)return i+1;if(!s&&i>0)return i-1}return i}}},8343:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound4EnvelopeControlRegister=t.sound2EnvelopeControlRegister=t.sound1EnvelopeControlRegister=t.EnvelopeControlRegister=void 0;const r=i(8254);class e{constructor(n,d){this.offset=n,this.name=d}get value(){return r.memory.readByte(this.offset)}get initialVolume(){return this.value>>4}get isEnvelopeRising(){return(this.value>>3&1)==1}get lengthOfEnvelopeStep(){return 7&this.value}}t.EnvelopeControlRegister=e,t.sound1EnvelopeControlRegister=new e(65298,"NR12"),t.sound2EnvelopeControlRegister=new e(65303,"NR22"),t.sound4EnvelopeControlRegister=new e(65313,"NR42")},9550:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound3HighOrderFrequencyRegister=t.sound2HighOrderFrequencyRegister=t.sound1HighOrderFrequencyRegister=t.HighOrderFrequencyRegister=void 0;const r=i(5425),e=i(8254);class s{constructor(d,f){this.offset=d,this.name=f}get value(){return e.memory.readByte(this.offset)}get highOrderFrequencyRegister(){return this.value}get isInitialize(){return this.value>>7==1}set isInitialize(d){const f=r.setBit(this.value,7,d?1:0);e.memory.writeByte(this.offset,f)}get isContinuousSelection(){return(this.value>>6&1)==0}get highOrderFrequencyData(){return 7&this.value}}t.HighOrderFrequencyRegister=s,t.sound1HighOrderFrequencyRegister=new s(65300,"NR14"),t.sound2HighOrderFrequencyRegister=new s(65305,"NR24"),t.sound3HighOrderFrequencyRegister=new s(65310,"NR34")},1280:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound2LengthAndDutyCycleRegister=t.sound1LengthAndDutyCycleRegister=t.LengthAndDutyCycleRegister=void 0;const r=i(8254);class e{constructor(n,d){this.offset=n,this.name=d}get value(){return r.memory.readByte(this.offset)}get waveformDutyCycle(){return this.value>>6}get soundLength(){return 63&this.value}}t.LengthAndDutyCycleRegister=e,t.sound1LengthAndDutyCycleRegister=new e(65297,"NR11"),t.sound2LengthAndDutyCycleRegister=new e(65302,"NR21")},1090:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound3LowOrderFrequencyRegister=t.sound2LowOrderFrequencyRegister=t.sound1LowOrderFrequencyRegister=t.LowOrderFrequencyRegisters=void 0;const r=i(8254);class e{constructor(n,d){this.offset=n,this.name=d}get value(){return r.memory.readByte(this.offset)}}t.LowOrderFrequencyRegisters=e,t.sound1LowOrderFrequencyRegister=new e(65299,"NR13"),t.sound2LowOrderFrequencyRegister=new e(65304,"NR23"),t.sound3LowOrderFrequencyRegister=new e(65309,"NR33")},9229:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound3LengthRegister=t.Sound3LengthRegister=void 0;const r=i(8254);class e{constructor(){this.offset=65307,this.name="NR31"}get value(){return r.memory.readByte(this.offset)}}t.Sound3LengthRegister=e,t.sound3LengthRegister=new e},9564:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound3OutputLevelRegister=t.Sound3OutputLevelRegister=void 0;const r=i(8254);class e{constructor(){this.offset=65308,this.name="NR32"}get value(){return r.memory.readByte(this.offset)}get outputLevel(){return this.value>>5&3}}t.Sound3OutputLevelRegister=e,t.sound3OutputLevelRegister=new e},1436:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound4ContinuousSelectionRegister=t.Sound4ContinuousSelectionRegister=void 0;const r=i(8254),e=i(5425);class s{constructor(){this.offset=65315,this.name="NR44"}get value(){return r.memory.readByte(this.offset)}get isInitialize(){return this.value>>7==1}set isInitialize(d){const f=e.setBit(this.value,7,d?1:0);r.memory.writeByte(this.offset,f)}get isContinuousSelection(){return(this.value>>6&1)==0}}t.Sound4ContinuousSelectionRegister=s,t.sound4ContinuousSelectionRegister=new s},5352:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound4LengthRegister=t.Sound4LengthRegister=void 0;const r=i(8254);class e{constructor(){this.offset=65312,this.name="NR41"}get value(){return r.memory.readByte(this.offset)}get soundLength(){return 63&this.value}}t.Sound4LengthRegister=e,t.sound4LengthRegister=new e},9999:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound4PolynomialRegister=void 0;const r=i(8254);t.sound4PolynomialRegister=new class{constructor(){this.offset=65314,this.name="NR43",this.divisors=[8,16,32,48,64,80,96,112]}get value(){return r.memory.readByte(this.offset)}get clockShift(){return this.value>>4}get counterWidth(){return(this.value>>3&1)==1?7:15}get dividingRatio(){return 3&this.value}get divisor(){const e=7&this.value;return this.divisors[e]}get frequency(){const e=this.dividingRatio;return 524288/(e===0?.5:e)/Math.pow(2,this.clockShift+1)}}},6001:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.soundsOnRegister=void 0;const r=i(8254),e=i(5425);t.soundsOnRegister=new class{constructor(){this.offset=65318,this.name="NR52"}get value(){return r.memory.readByte(this.offset)}set value(s){r.memory.writeByte(this.offset,s)}get isAllSoundOn(){return(this.value>>7&1)==1}get isSound4On(){return(this.value>>3&1)==1}get isSound3On(){return(this.value>>2&1)==1}get isSound2On(){return(this.value>>1&1)==1}get isSound1On(){return(1&this.value)==1}set isSound1On(s){this.value=e.setBit(this.value,0,s?1:0)}set isSound2On(s){this.value=e.setBit(this.value,1,s?1:0)}set isSound3On(s){this.value=e.setBit(this.value,2,s?1:0)}set isSound4On(s){this.value=e.setBit(this.value,3,s?1:0)}}},5014:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sweepControlRegister=t.SweepControlRegister=void 0;const r=i(8254);class e{constructor(){this.offset=65297,this.name="NR11"}get value(){return r.memory.readByte(this.offset)}get sweepTime(){return this.value>>4&7}get sweepTimeInSeconds(){return this.sweepTime/1280}get isSweepIncrease(){return(this.value>>3&1)==1}get sweepAmount(){return 7&this.value}}t.SweepControlRegister=e,t.sweepControlRegister=new e},3210:function(h,t,i){var r=this&&this.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(t,"__esModule",{value:!0}),t.RingBufferPlayer=void 0;const e=i(2298),s=r(i(6509));t.RingBufferPlayer=class{constructor(n,d){this.sampleBufferIndex=0,this.sampleBuffer=new Float32Array(d),this.parameterRawStorage=new ArrayBuffer(5),this.parameterByteArray=new Uint8Array(this.parameterRawStorage),this.parameterDataView=new DataView(this.parameterRawStorage),n.audioWorklet.addModule(this.getModuleFile()).then(()=>{const f=e.RingBufferWriter.GetSharedArrayBufferForCapacity(n.sampleRate/20,Float32Array);this.audioRingBufferWriter=new e.RingBufferWriter(f,Float32Array);const u=e.RingBufferWriter.GetSharedArrayBufferForCapacity(32,Uint8Array);this.parameterRingBufferWriter=new e.RingBufferWriter(u,Uint8Array),this.ringBufferPlayerNode=new AudioWorkletNode(n,"ring-buffer-processor",{processorOptions:{audioQueue:f,paramQueue:u}}),this.ringBufferPlayerNode.connect(n.destination)})}writeSample(n){var d;this.sampleBuffer[this.sampleBufferIndex]=n,this.sampleBufferIndex++,this.sampleBufferIndex===this.sampleBuffer.length&&((d=this.audioRingBufferWriter)==null||d.push(this.sampleBuffer),this.sampleBufferIndex=0)}writeParameter(n,d){return this.parameterDataView.setUint8(0,n),this.parameterDataView.setFloat32(1,d),!(!this.parameterRingBufferWriter||this.parameterRingBufferWriter.availableWrite()<this.parameterRawStorage.byteLength)&&this.parameterRingBufferWriter&&this.parameterRingBufferWriter.push(this.parameterByteArray)===this.parameterRawStorage.byteLength}getModuleFile(){const n=s.default,d=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(d)}}},2298:(h,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RingBufferWriter=void 0;class i{constructor(e,s){this.capacity=(e.byteLength-i.SizeOfPointers)/s.BYTES_PER_ELEMENT,this.sharedBuffer=e,this.writePointer=new Uint32Array(this.sharedBuffer,0,1),this.readPointer=new Uint32Array(this.sharedBuffer,4,1),this.storage=new s(this.sharedBuffer,8,this.capacity)}static GetSharedArrayBufferForCapacity(e,s){const n=(e+1)*s.BYTES_PER_ELEMENT+i.SizeOfPointers;return new SharedArrayBuffer(n)}push(e){const s=Atomics.load(this.readPointer,0),n=Atomics.load(this.writePointer,0),d=this._availableWrite(s,n);if(d===0)return console.log("full"),0;const f=Math.min(d,e.length),u=Math.min(this.capacity-n,f),c=f-u;this.copy(e,0,this.storage,n,u),this.copy(e,u,this.storage,0,c);const l=(n+f)%this.capacity;return Atomics.store(this.writePointer,0,l),f}availableWrite(){const e=Atomics.load(this.readPointer,0),s=Atomics.load(this.writePointer,0);return this._availableWrite(e,s)}_availableWrite(e,s){let n=e-s-1;return s>=e&&(n+=this.capacity),n}copy(e,s,n,d,f){for(let u=0;u<f;u++)n[d+u]=e[s+u]}}t.RingBufferWriter=i,i.WritePointerByteSize=4,i.ReadPointerByteSize=4,i.SizeOfPointers=i.WritePointerByteSize+i.ReadPointerByteSize},8107:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Sound1=void 0;const r=i(8254),e=i(7637),s=i(8343),n=i(5014),d=i(1280),f=i(9550),u=i(1090),c=i(6001);t.Sound1=class{constructor(){this.dutyCycles=[[0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,1],[1,0,0,0,0,1,1,1],[0,1,1,1,1,1,1,0]],this.positionInDutyCycle=0,this.frequencyTimer=0,this.frequencyPeriod=this.getFrequencyPeriod(),this.lengthTimer=0,this.enveloper=new e.Enveloper,this.volume=0,this.isSweepEnabled=!1,this.shadowFrequency=0,this.sweepTimer=0}tick(l){f.sound1HighOrderFrequencyRegister.isInitialize&&(this.playSound(),f.sound1HighOrderFrequencyRegister.isInitialize=!1),this.frequencyTimer-=l,this.frequencyTimer<=0&&(this.frequencyTimer+=this.frequencyPeriod,this.positionInDutyCycle=(this.positionInDutyCycle+1)%8)}playSound(){c.soundsOnRegister.isSound1On=!0,this.frequencyPeriod=this.getFrequencyPeriod(),this.frequencyTimer=this.frequencyPeriod,this.volume=s.sound1EnvelopeControlRegister.initialVolume,this.enveloper.initializeTimer(s.sound1EnvelopeControlRegister.lengthOfEnvelopeStep),this.lengthTimer=64-d.sound1LengthAndDutyCycleRegister.soundLength}clockLength(){f.sound1HighOrderFrequencyRegister.isContinuousSelection||(this.lengthTimer--,this.lengthTimer===0&&(c.soundsOnRegister.isSound1On=!1))}clockVolume(){this.volume=this.enveloper.clockVolume(this.volume,s.sound1EnvelopeControlRegister)}clockSweep(){if(this.sweepTimer>0&&this.sweepTimer--,this.sweepTimer===0&&(this.resetSweepTimer(),this.isSweepEnabled&&n.sweepControlRegister.sweepTime>0)){const l=this.calculateNewSweepFrequency();l<2048&&n.sweepControlRegister.sweepAmount>0&&(this.shadowFrequency=l,this.frequencyPeriod=4*(2048-l))}}resetSweepTimer(){this.sweepTimer=n.sweepControlRegister.sweepTime,this.sweepTimer===0&&(this.sweepTimer=8)}calculateNewSweepFrequency(){const{sweepAmount:l,isSweepIncrease:m}=n.sweepControlRegister,b=this.shadowFrequency>>l,A=m?-b:b,S=this.shadowFrequency+A;return S>=2048&&(c.soundsOnRegister.isSound1On=!1),S}getSample(){const l=this.dutyCycles[d.sound1LengthAndDutyCycleRegister.waveformDutyCycle][this.positionInDutyCycle];return c.soundsOnRegister.isSound1On?l*this.volume/15:0}getFrequencyPeriod(){return 4*(2048-(2047&r.memory.readWord(u.sound1LowOrderFrequencyRegister.offset)))}}},1710:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Sound2=void 0;const r=i(8254),e=i(7637),s=i(8343),n=i(9550),d=i(1280),f=i(1090),u=i(6001);t.Sound2=class{constructor(){this.dutyCycles=[[0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,1],[1,0,0,0,0,1,1,1],[0,1,1,1,1,1,1,0]],this.positionInDutyCycle=0,this.frequencyTimer=0,this.frequencyPeriod=this.getFrequencyPeriod(),this.lengthTimer=0,this.enveloper=new e.Enveloper,this.volume=0}tick(c){n.sound2HighOrderFrequencyRegister.isInitialize&&(this.playSound(),n.sound2HighOrderFrequencyRegister.isInitialize=!1),this.frequencyTimer-=c,this.frequencyTimer<=0&&(this.frequencyTimer+=this.frequencyPeriod,this.positionInDutyCycle=(this.positionInDutyCycle+1)%8)}playSound(){u.soundsOnRegister.isSound2On=!0,this.frequencyPeriod=this.getFrequencyPeriod(),this.frequencyTimer=this.frequencyPeriod,this.volume=s.sound2EnvelopeControlRegister.initialVolume,this.enveloper.initializeTimer(s.sound2EnvelopeControlRegister.lengthOfEnvelopeStep),this.lengthTimer=64-d.sound2LengthAndDutyCycleRegister.soundLength}clockLength(){n.sound2HighOrderFrequencyRegister.isContinuousSelection||(this.lengthTimer--,this.lengthTimer===0&&(u.soundsOnRegister.isSound2On=!1))}clockVolume(){this.volume=this.enveloper.clockVolume(this.volume,s.sound2EnvelopeControlRegister)}getSample(){const c=this.dutyCycles[d.sound2LengthAndDutyCycleRegister.waveformDutyCycle][this.positionInDutyCycle];return u.soundsOnRegister.isSound2On&&this.volume>0?c*this.volume/15:0}getFrequencyPeriod(){return 4*(2048-(2047&r.memory.readWord(f.sound2LowOrderFrequencyRegister.offset)))}}},3893:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Sound3=void 0;const r=i(8254),e=i(9550),s=i(9564),n=i(1090),d=i(6001),f=i(5425),u=i(9229);t.Sound3=class{constructor(){this.frequencyTimer=0,this.frequencyPeriod=this.getFrequencyPeriod(),this.lengthTimer=0,this.waveTableMemoryAddress=65328,this.waveTablePosition=0,this.shifts=[4,0,1,2]}tick(c){e.sound3HighOrderFrequencyRegister.isInitialize&&(this.playSound(),e.sound3HighOrderFrequencyRegister.isInitialize=!1),this.frequencyTimer-=c,this.frequencyTimer<=0&&(this.frequencyTimer+=this.frequencyPeriod,this.waveTablePosition++,this.waveTablePosition===32&&(this.waveTablePosition=0))}playSound(){d.soundsOnRegister.isSound3On=!0,this.waveTablePosition=0,this.frequencyPeriod=this.getFrequencyPeriod(),this.frequencyTimer=this.frequencyPeriod,this.lengthTimer=256-u.sound3LengthRegister.value}clockLength(){e.sound3HighOrderFrequencyRegister.isContinuousSelection||(this.lengthTimer--,this.lengthTimer===0&&(d.soundsOnRegister.isSound3On=!1))}getSample(){const c=Math.floor(this.waveTablePosition/2),l=r.memory.readByte(this.waveTableMemoryAddress+c),m=(this.waveTablePosition%2==1?f.getLowerNibble(l):f.getUpperNibble(l))>>this.shifts[s.sound3OutputLevelRegister.outputLevel];return d.soundsOnRegister.isSound3On&&s.sound3OutputLevelRegister.outputLevel!==0?m/15:0}getFrequencyPeriod(){return 2*(2048-(2047&r.memory.readWord(n.sound3LowOrderFrequencyRegister.offset)))}}},6283:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Sound4=void 0;const r=i(7637),e=i(5425),s=i(9999),n=i(8343),d=i(1436),f=i(5352),u=i(6001);t.Sound4=class{constructor(){this.frequencyTimer=0,this.frequencyPeriod=this.getFrequencyPeriod(),this.lengthTimer=0,this.enveloper=new r.Enveloper,this.volume=0,this.linearFeedbackShift=0}tick(c){d.sound4ContinuousSelectionRegister.isInitialize&&(this.playSound(),d.sound4ContinuousSelectionRegister.isInitialize=!1),this.frequencyTimer-=c,this.frequencyTimer<=0&&(this.frequencyTimer=this.getFrequencyPeriod(),this.stepLinearFeedbackShift())}getFrequencyPeriod(){return s.sound4PolynomialRegister.divisor<<s.sound4PolynomialRegister.clockShift}playSound(){u.soundsOnRegister.isSound4On=!0,this.linearFeedbackShift=32767,this.frequencyPeriod=this.getFrequencyPeriod(),this.frequencyTimer=this.frequencyPeriod,this.volume=n.sound4EnvelopeControlRegister.initialVolume,this.enveloper.initializeTimer(n.sound4EnvelopeControlRegister.lengthOfEnvelopeStep),this.lengthTimer=64-f.sound4LengthRegister.soundLength}clockLength(){d.sound4ContinuousSelectionRegister.isContinuousSelection||(this.lengthTimer--,this.lengthTimer===0&&(u.soundsOnRegister.isSound4On=!1))}clockVolume(){this.volume=this.enveloper.clockVolume(this.volume,n.sound4EnvelopeControlRegister)}stepLinearFeedbackShift(){const c=e.getBit(this.linearFeedbackShift,0),l=e.getBit(this.linearFeedbackShift,1)^c;this.linearFeedbackShift>>=1,this.linearFeedbackShift=e.setBit(this.linearFeedbackShift,14,l),s.sound4PolynomialRegister.counterWidth===7&&(this.linearFeedbackShift=e.setBit(this.linearFeedbackShift,6,l))}getSample(){const c=1&~this.linearFeedbackShift;return u.soundsOnRegister.isSound4On&&this.volume>0?c*this.volume/15:0}}},7189:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CartridgeLoader=void 0;const r=i(3426),e=i(9268),s=i(9259),n=i(1992);class d{static FromArrayBuffer(u){const c=new DataView(u);switch(c.getUint8(d.TypeOffset)){case r.CartridgeType.ROM:return new s.Cartridge(c);case r.CartridgeType.MBC1:case r.CartridgeType.MBC1_RAM:case r.CartridgeType.MBC1_RAM_BATTERY:return new e.Mbc1Cartridge(c);case r.CartridgeType.MBC3:case r.CartridgeType.MBC3_RAM:case r.CartridgeType.MBC3_RAM_BATTERY:case r.CartridgeType.MBC3_TIMER_BATTERY:case r.CartridgeType.MBC3_TIMER_RAM_BATTERY:return new n.Mbc3Cartridge(c);default:return alert("oops not ready"),new s.Cartridge(c)}}}t.CartridgeLoader=d,d.TypeOffset=327},3426:(h,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.CartridgeType=void 0,(i=t.CartridgeType||(t.CartridgeType={}))[i.ROM=0]="ROM",i[i.MBC1=1]="MBC1",i[i.MBC1_RAM=2]="MBC1_RAM",i[i.MBC1_RAM_BATTERY=3]="MBC1_RAM_BATTERY",i[i.MBC2=5]="MBC2",i[i.MBC2_BATTERY=6]="MBC2_BATTERY",i[i.ROM_RAM=8]="ROM_RAM",i[i.ROM_RAM_BATTERY=9]="ROM_RAM_BATTERY",i[i.MMM01=11]="MMM01",i[i.MMM01_RAM=12]="MMM01_RAM",i[i.MMM01_RAM_BATTERY=13]="MMM01_RAM_BATTERY",i[i.MBC3_TIMER_BATTERY=15]="MBC3_TIMER_BATTERY",i[i.MBC3_TIMER_RAM_BATTERY=16]="MBC3_TIMER_RAM_BATTERY",i[i.MBC3=17]="MBC3",i[i.MBC3_RAM=18]="MBC3_RAM",i[i.MBC3_RAM_BATTERY=19]="MBC3_RAM_BATTERY",i[i.MBC5=25]="MBC5",i[i.MBC5_RAM=26]="MBC5_RAM",i[i.MBC5_RAM_BATTERY=27]="MBC5_RAM_BATTERY",i[i.MBC5_RUMBLE=28]="MBC5_RUMBLE",i[i.MBC5_RUMBLE_RAM=29]="MBC5_RUMBLE_RAM",i[i.MBC5_RUMBLE_RAM_BATTERY=30]="MBC5_RUMBLE_RAM_BATTERY",i[i.MBC6=32]="MBC6",i[i.MBC7_SENSOR_RUMBLE_RAM_BATTERY=34]="MBC7_SENSOR_RUMBLE_RAM_BATTERY",i[i.POCKET_CAMERA=252]="POCKET_CAMERA",i[i.BANDAI_TAMA5=253]="BANDAI_TAMA5",i[i.HuC3=254]="HuC3",i[i.HuC1_RAM_BATTERY=255]="HuC1_RAM_BATTERY"},9259:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Cartridge=void 0;const r=i(3426);class e{constructor(n){this.gameDataView=n,this.gameBytes=new Uint8Array(n.buffer)}readByte(n){return this.gameDataView.getUint8(n)}readSignedByte(n){return this.gameDataView.getInt8(n)}readWord(n){return this.gameDataView.getUint16(n,!0)}writeByte(n,d){}writeWord(n,d){}get title(){const n=new TextDecoder,d=this.gameBytes.subarray(308,323);return n.decode(d)}get typeName(){const n=this.gameDataView.getUint8(327);return r.CartridgeType[n]}get type(){return this.gameDataView.getUint8(327)}get romSize(){return[32768,65536,131072,262144,524288,1048576,2097152,4096,8192][this.gameDataView.getUint8(328)]}get ramSize(){return[0,8192,32768,204800,1212416,5316608][this.gameDataView.getUint8(329)]}get versionNumber(){return this.gameDataView.getUint8(332)}get hasSaveableRam(){return e.TypesWithBatterySave.includes(this.type)}}t.Cartridge=e,e.EntryPointOffset=256,e.TypesWithBatterySave=[r.CartridgeType.ROM_RAM_BATTERY,r.CartridgeType.MBC1_RAM_BATTERY,r.CartridgeType.MBC2_BATTERY,r.CartridgeType.MBC3_RAM_BATTERY]},9268:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Mbc1Cartridge=void 0;const r=i(9259),e=i(3426);var s,n;(function(f){f[f.RamGateRegister=0]="RamGateRegister",f[f.Bank1Register=1]="Bank1Register",f[f.Bank2Register=2]="Bank2Register",f[f.ModeRegister=3]="ModeRegister",f[f.Sram=4]="Sram"})(s||(s={})),function(f){f[f.RomBankZero=0]="RomBankZero",f[f.RomBankZeroMode1=1]="RomBankZeroMode1",f[f.RomBank=2]="RomBank",f[f.Sram=3]="Sram",f[f.Invalid=4]="Invalid"}(n||(n={}));class d extends r.Cartridge{constructor(u){super(u),this.isRamEnabled=!1,this.bank1=1,this.bank2=0,this.mode=0,this.ramData=new ArrayBuffer(this.ramSize),this.ramDataView=new DataView(this.ramData),this.ramBytes=new Uint8Array(this.ramDataView.buffer),this.ramBytes.fill(255)}setRam(u){this.ramData=u,this.ramDataView=new DataView(this.ramData),this.ramBytes=new Uint8Array(this.ramDataView.buffer)}dumpRam(){return this.ramDataView.buffer}writeByte(u,c){this.write(u,c,(l,m)=>{this.ramDataView.setUint8(l,m),this.type===e.CartridgeType.MBC1_RAM_BATTERY&&this.onSramWrite&&(clearTimeout(this.writeTimeout),this.writeTimeout=setTimeout(()=>this.onSramWrite(this.ramData),500))})}writeWord(u,c){this.write(u,c,(l,m)=>{this.ramDataView.setUint16(l,m,!0),this.type===e.CartridgeType.MBC1_RAM_BATTERY&&this.onSramWrite&&(clearTimeout(this.writeTimeout),this.writeTimeout=setTimeout(()=>this.onSramWrite(this.ramData),500))})}readByte(u){return this.read(u,c=>this.gameDataView.getUint8(c),c=>this.ramDataView.getUint8(c))}readSignedByte(u){return this.read(u,c=>this.gameDataView.getInt8(c),c=>this.ramDataView.getInt8(c))}readWord(u){return this.read(u,c=>this.gameDataView.getUint16(c,!0),c=>this.ramDataView.getUint16(c,!0))}read(u,c,l){const m=16383&u;if(u>=0&&u<=16383)return this.mode===0?c(m):c((this.bank2<<5<<14)+m&this.romSize-1);if(u>=16384&&u<=32767)return c(((this.bank2<<5)+this.bank1<<14)+m&this.romSize-1);{if(!this.isRamEnabled)return 255;const b=8191&u;return this.mode===0||this.ramSize===32768?l(b):l((this.bank2<<13)+b)}}write(u,c,l){if(this.isRamGate(u)){const b=15&c;this.isRamEnabled=b===10}else if(this.isBank1(u)){const m=31&c;this.bank1=m===0?1:m}else if(this.isBank2(u))this.bank2=3&c;else if(this.isMode(u))this.mode=1&c;else if(this.isRam(u)&&this.isRamEnabled){const m=8191&u;this.mode===0||this.ramSize===32768?l(m,c):l((this.bank2<<13)+m,c)}}isRamGate(u){return u>=0&&u<=8191}isBank1(u){return u>=8192&&u<=16383}isBank2(u){return u>=16384&&u<=24575}isMode(u){return u>=24576&&u<=32767}isRam(u){return u>=40960&&u<=49151}}t.Mbc1Cartridge=d},1992:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Mbc3Cartridge=void 0;const r=i(9259),e=i(3426);class s extends r.Cartridge{constructor(d){super(d),this.romBank=0,this.isRamAndRtcEnabled=!1,this.ramBankOrRtcSelection=0,this.ramData=new ArrayBuffer(this.ramSize),this.ramDataView=new DataView(this.ramData),this.ramBytes=new Uint8Array(this.ramDataView.buffer),this.ramBytes.fill(255)}setRam(d){this.ramData=d,this.ramDataView=new DataView(this.ramData),this.ramBytes=new Uint8Array(this.ramDataView.buffer)}dumpRam(){return this.ramDataView.buffer}writeByte(d,f){this.write(d,f,(u,c)=>{this.ramDataView.setUint8(u,c),this.type===e.CartridgeType.MBC3_RAM_BATTERY&&this.onSramWrite&&(clearTimeout(this.writeTimeout),this.writeTimeout=setTimeout(()=>this.onSramWrite(this.ramData),500))})}writeWord(d,f){this.write(d,f,(u,c)=>{this.ramDataView.setUint16(u,c,!0),this.type===e.CartridgeType.MBC3_RAM_BATTERY&&this.onSramWrite&&(clearTimeout(this.writeTimeout),this.writeTimeout=setTimeout(()=>this.onSramWrite(this.ramData),500))})}readByte(d){return this.read(d,f=>this.gameDataView.getUint8(f),f=>this.ramDataView.getUint8(f))}readSignedByte(d){return this.read(d,f=>this.gameDataView.getInt8(f),f=>this.ramDataView.getInt8(f))}readWord(d){return this.read(d,f=>this.gameDataView.getUint16(f,!0),f=>this.ramDataView.getUint16(f,!0))}read(d,f,u){const c=16383&d;if(d>=0&&d<=16383)return f(d);if(d>=16384&&d<=32767)return f((this.romBank<<14)+c&this.romSize-1);if(!this.isRamAndRtcEnabled)return 255;if(this.ramBankOrRtcSelection<=3){const l=8191&d;return u((this.ramBankOrRtcSelection<<13)+l)}}write(d,f,u){if(this.isRamAndTimerGate(d)){const l=15&f;this.isRamAndRtcEnabled=l===10}else if(this.isRomBank(d)){const c=127&f;this.romBank=c===0?1:c}else if(this.isRamBankNumberOrRtcRegisterSelect(d))this.ramBankOrRtcSelection=f;else if(this.isLatchClockData(d))console.log("not implemented");else if(this.isRamBankOrRtcRegister(d)){const c=8191&d;this.ramBankOrRtcSelection<=3&&u((this.ramBankOrRtcSelection<<13)+c,f)}}isRamAndTimerGate(d){return d>=0&&d<=8191}isRomBank(d){return d>=8192&&d<=16383}isRamBankNumberOrRtcRegisterSelect(d){return d>=16384&&d<=24575}isLatchClockData(d){return d>=24576&&d<=32767}isRamBankOrRtcRegister(d){return d>=40960&&d<=49151}}t.Mbc3Cartridge=s},9145:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CPU=void 0;const r=i(2710),e=i(8254),s=i(7294),n=i(5494),d=i(1456),f=i(9879),u=i(927),c=i(8543),l=i(9099),m=i(9259),b=i(5449),A=i(7300),S=i(3739),k=i(9904),x=i(5425),F=i(9080),C=i(6584),$=i(4002),P=i(3120);class B{constructor(){this.isInterruptMasterEnable=!0,this.operationMap=new Map,this.cbSubOperationMap=new Map,this.createInputOutputOperations=k.createInputOutputOperations,this.createArithmeticOperations=S.createArithmeticOperations,this.createLogicalOperations=A.createLogicalOperations,this.createRotateShiftOperations=f.createRotateShiftOperations,this.createJumpOperations=d.createJumpOperations,this.createGeneralPurposeOperations=u.createGeneralPurposeOperations,this.createCallAndReturnOperations=s.createCallAndReturnOperations,this.createInterruptOperations=n.createInterruptOperations,this.createCbSubOperations=b.createCbSubOperations,this.timerCycles=0,this.frequencyCounter=0,this.cycleMultiplier=4,this.isHalted=!1,this.isStopped=!1,this.registers=new r.CpuRegisterCollection,this.createInputOutputOperations(),this.createArithmeticOperations(),this.createLogicalOperations(),this.createRotateShiftOperations(),this.createJumpOperations(),this.createGeneralPurposeOperations(),this.createCallAndReturnOperations(),this.createInterruptOperations(),this.createCbSubOperations(),this.initialize()}initialize(){this.registers.programCounter.value=m.Cartridge.EntryPointOffset,this.registers.stackPointer.value=65534,this.registers.HL.value=333,this.registers.C.value=19,this.registers.E.value=216,this.registers.A.value=1,this.registers.F.value=176}tick(){if(this.handleInterrupts(),this.isHalted)return this.updateTimers(1),1;const R=this.getOperation();return R.execute(),this.updateTimers(R.cycleTime),R.cycleTime}reset(){this.registers.reset()}halt(){this.isHalted=!0}stop(){this.isStopped=!0}pushToStack(R){this.registers.stackPointer.value-=2,e.memory.writeWord(this.registers.stackPointer.value,R)}popFromStack(){const R=e.memory.readWord(this.registers.stackPointer.value);return this.registers.stackPointer.value+=2,R}getOperation(){const R=e.memory.readByte(this.registers.programCounter.value);this.registers.programCounter.value++;const T=this.operationMap.get(R);if(!T){const D=R.toString(16),M=this.registers.programCounter.value.toString(16);throw new Error(`Operation ${D} at location ${M} not found.`)}return T}handleInterrupts(){const R=c.interruptRequestRegister.value&l.interruptEnableRegister.value;if(R>0&&(this.isHalted=!1),!this.isInterruptMasterEnable||R===0)return;this.pushToStack(this.registers.programCounter.value);const T=c.interruptRequestRegister.getInterruptFlags(R);T.isVerticalBlanking?(c.interruptRequestRegister.clearVBlankInterruptRequest(),this.registers.programCounter.value=B.VBlankInterruptAddress):T.isLCDStatus?(c.interruptRequestRegister.clearLcdStatusInterruptRequest(),this.registers.programCounter.value=B.LCDStatusInterruptAddress):T.isTimerOverflow?(c.interruptRequestRegister.clearTimerOverflowInterruptRequest(),this.registers.programCounter.value=B.TimerOverflowInterruptAddress):T.isSerialTransferCompletion?(c.interruptRequestRegister.clearSerialTransferInterruptRequest(),this.registers.programCounter.value=B.SerialTransferCompletionInterruptAddress):T.isP10P13NegativeEdge&&(c.interruptRequestRegister.clearP10P13NegativeEdgeInterruptRequest(),this.registers.programCounter.value=B.P10P13InputSignalLowInterruptAddress),this.isInterruptMasterEnable=!1}updateTimers(R){this.frequencyCounter=x.asUint16(this.frequencyCounter+R*this.cycleMultiplier),F.dividerRegister.setValueFromCpuDivider(x.getMostSignificantByte(this.frequencyCounter)),C.timerControllerRegister.isTimerOn&&(this.timerCycles+=R,this.timerCycles>=C.timerControllerRegister.cyclesForTimerUpdate&&($.timerCounterRegister.value+1>255&&(c.interruptRequestRegister.triggerTimerInterruptRequest(),$.timerCounterRegister.value=P.timerModuloRegister.value),$.timerCounterRegister.value++,this.timerCycles=0))}addOperation(R){if(this.operationMap.has(R.byteDefinition))throw new Error(`Operation ${R.byteDefinition.toString(2)} has already been defined`);this.operationMap.set(R.byteDefinition,R)}addCbOperation(R){if(this.cbSubOperationMap.has(R.byteDefinition))throw new Error(`Operation ${R.byteDefinition.toString(2)} has already been defined`);this.cbSubOperationMap.set(R.byteDefinition,R)}}t.CPU=B,B.OperatingHertz=4194304,B.VBlankInterruptAddress=64,B.LCDStatusInterruptAddress=72,B.TimerOverflowInterruptAddress=80,B.SerialTransferCompletionInterruptAddress=88,B.P10P13InputSignalLowInterruptAddress=96},8025:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CpuFlagRegisterPair=void 0;const r=i(3115);class e extends r.CpuRegister{get value(){return this.dataView.getUint16(this.offset,!0)}set value(n){this.dataView.setUint16(this.offset,65520&n,!0)}}t.CpuFlagRegisterPair=e},9754:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CpuFlagRegister=void 0;const r=i(3115);class e extends r.CpuRegister{get Z(){return this.value>>7}set Z(n){n===1?this.value|=128:this.value&=-129}get isResultZero(){return this.Z===1}set isResultZero(n){this.Z=n?1:0}get N(){return this.value>>6&1}set N(n){n===1?this.value|=64:this.value&=-65}get isSubtraction(){return this.N===1}set isSubtraction(n){this.N=n?1:0}get H(){return this.value>>5&1}set H(n){n===1?this.value|=32:this.value&=-33}get isHalfCarry(){return this.H===1}set isHalfCarry(n){this.H=n?1:0}get CY(){return this.value>>4&1}set CY(n){n===1?this.value|=16:this.value&=-17}get isCarry(){return this.CY===1}set isCarry(n){this.CY=n?1:0}}t.CpuFlagRegister=e},2710:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CpuRegisterCollection=void 0;const r=i(3115),e=i(9754),s=i(8025);t.CpuRegisterCollection=class{constructor(){this.registersBuffer=new ArrayBuffer(12),this.registersView=new DataView(this.registersBuffer),this.F=new e.CpuFlagRegister("F",0,this.registersBuffer,-1),this.A=new r.CpuRegister("A",1,this.registersBuffer,r.CpuRegister.Code.A),this.C=new r.CpuRegister("C",2,this.registersBuffer,r.CpuRegister.Code.C),this.B=new r.CpuRegister("B",3,this.registersBuffer,r.CpuRegister.Code.B),this.E=new r.CpuRegister("E",4,this.registersBuffer,r.CpuRegister.Code.E),this.D=new r.CpuRegister("D",5,this.registersBuffer,r.CpuRegister.Code.D),this.L=new r.CpuRegister("L",6,this.registersBuffer,r.CpuRegister.Code.L),this.H=new r.CpuRegister("H",7,this.registersBuffer,r.CpuRegister.Code.H),this.AF=new s.CpuFlagRegisterPair("AF",0,this.registersBuffer,r.CpuRegister.PairCode.AF,2),this.BC=new r.CpuRegister("BC",2,this.registersBuffer,r.CpuRegister.PairCode.BC,2),this.DE=new r.CpuRegister("DE",4,this.registersBuffer,r.CpuRegister.PairCode.DE,2),this.HL=new r.CpuRegister("HL",6,this.registersBuffer,r.CpuRegister.PairCode.HL,2),this.programCounter=new r.CpuRegister("PC",8,this.registersBuffer,-1,2),this.stackPointer=new r.CpuRegister("SP",10,this.registersBuffer,r.CpuRegister.PairCode.SP,2),this.baseRegisters=[this.A,this.B,this.C,this.D,this.E,this.H,this.L],this.registerPairs=[this.AF,this.BC,this.DE,this.HL,this.stackPointer]}get flags(){return this.F}reset(){this.registersBuffer=new ArrayBuffer(12),this.registersView=new DataView(this.registersBuffer)}}},3115:(h,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CpuRegister=void 0;class i{constructor(e,s,n,d,f=1){this.name=e,this.offset=s,this.dataView=new DataView(n),this.code=d,this.byteSize=f}get value(){return this.byteSize===1?this.dataView.getUint8(this.offset):this.dataView.getUint16(this.offset,!0)}set value(e){this.byteSize===1?this.dataView.setUint8(this.offset,e):this.dataView.setUint16(this.offset,e,!0)}}t.CpuRegister=i,function(r){(function(e){e[e.A=7]="A",e[e.B=0]="B",e[e.C=1]="C",e[e.D=2]="D",e[e.E=3]="E",e[e.H=4]="H",e[e.L=5]="L"})(r.Code||(r.Code={})),function(e){e[e.BC=0]="BC",e[e.DE=1]="DE",e[e.HL=2]="HL",e[e.AF=3]="AF",e[e.SP=3]="SP"}(r.PairCode||(r.PairCode={}))}(i=t.CpuRegister||(t.CpuRegister={}))},4114:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getBitSubOperations=void 0;const r=i(5425),e=i(8254);t.getBitSubOperations=function(s){const{registers:n}=s;function d(c,l){const m=r.getBit(c,l);n.flags.isResultZero=!m,n.flags.isHalfCarry=!0,n.flags.isSubtraction=!1}function f(c,l){return 64+(c<<3)+l}function u(c){return 64+(c<<3)+6}s.registers.baseRegisters.forEach(c=>{for(let l=0;l<8;l++)s.addCbOperation({byteDefinition:f(l,c.code),instruction:`BIT ${l}, ${c.name}`,cycleTime:2,byteLength:2,execute(){d(c.value,l)}})});for(let c=0;c<8;c++)s.addCbOperation({byteDefinition:u(c),instruction:`BIT ${c}, (HL)`,cycleTime:3,byteLength:2,execute(){d(e.memory.readByte(n.HL.value),c)}})}},5449:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createCbSubOperations=void 0;const r=i(9801),e=i(4114),s=i(6782),n=i(2238),d=i(8254);t.createCbSubOperations=function(){const f=this;this.addOperation({instruction:"",byteDefinition:203,cycleTime:0,byteLength:0,execute(){const u=d.memory.readByte(f.registers.programCounter.value);f.registers.programCounter.value++,f.cbSubOperationMap.get(u).execute()}}),r.getRotateShiftSubOperations(f),e.getBitSubOperations(f),s.getSetSubOperations(f),n.getResSubOperations(f)}},2238:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getResSubOperations=void 0;const r=i(5425),e=i(8254);t.getResSubOperations=function(s){const{registers:n}=s;function d(u,c){return 128+(u<<3)+c}function f(u){return 128+(u<<3)+6}s.registers.baseRegisters.forEach(u=>{for(let c=0;c<8;c++)s.addCbOperation({byteDefinition:d(c,u.code),instruction:`RES ${c}, ${u.name}`,cycleTime:2,byteLength:2,execute(){u.value=r.clearBit(u.value,c)}})});for(let u=0;u<8;u++)s.addCbOperation({byteDefinition:f(u),instruction:`RES ${u}, (HL)`,cycleTime:3,byteLength:2,execute(){const c=e.memory.readByte(n.HL.value),l=r.clearBit(c,u);e.memory.writeByte(n.HL.value,l)}})}},9801:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRotateShiftSubOperations=void 0;const r=i(8254),e=i(5425);t.getRotateShiftSubOperations=function(s){const{registers:n}=s;function d(f){const u=((15&f)<<4)+(f>>4);return n.flags.isResultZero=u===0,n.flags.isSubtraction=!1,n.flags.isHalfCarry=!1,n.flags.isCarry=!1,u}s.registers.baseRegisters.forEach(f=>{var u;s.addCbOperation({byteDefinition:(u=f.code,48+u),instruction:`SWAP ${f.name}`,cycleTime:2,byteLength:2,execute(){f.value=d(f.value)}})}),s.addCbOperation({byteDefinition:54,instruction:"SWAP (HL)",cycleTime:4,byteLength:2,execute(){const f=r.memory.readByte(n.HL.value);r.memory.writeByte(n.HL.value,d(f))}}),n.baseRegisters.forEach(f=>{var u;s.addCbOperation({byteDefinition:(u=f.code,0+u),instruction:`RLC ${f.name}`,cycleTime:2,byteLength:2,execute(){const c=f.value>>7;f.value=(f.value<<1)+c,n.flags.CY=c,n.flags.isHalfCarry=!1,n.flags.isResultZero=f.value===0,n.flags.isSubtraction=!1}})}),s.addCbOperation({byteDefinition:6,instruction:"RLC (HL)",cycleTime:4,byteLength:2,execute(){const f=r.memory.readByte(n.HL.value),u=f>>7,c=255&(f<<1&255)+u;r.memory.writeByte(n.HL.value,c),n.flags.CY=u,n.flags.isHalfCarry=!1,n.flags.isResultZero=c===0,n.flags.isSubtraction=!1}}),n.baseRegisters.forEach(f=>{var u;s.addCbOperation({instruction:`RL ${f.name}`,byteDefinition:(u=f.code,16+u),cycleTime:2,byteLength:2,execute(){const c=f.value>>7,l=255&(f.value<<1&255)+n.flags.CY;n.flags.CY=c,n.flags.isResultZero=l===0,n.flags.H=0,n.flags.N=0,f.value=l}})}),s.addCbOperation({instruction:"RL (HL)",byteDefinition:22,cycleTime:4,byteLength:2,execute(){const f=r.memory.readByte(n.HL.value),u=f>>7,c=255&(f<<1&255)+n.flags.CY;n.flags.CY=u,n.flags.H=0,n.flags.N=0,n.flags.isResultZero=c===0,r.memory.writeByte(n.HL.value,c)}}),n.baseRegisters.forEach(f=>{var u;s.addCbOperation({instruction:`RRC ${f.name}`,byteDefinition:(u=f.code,8+u),cycleTime:2,byteLength:2,execute(){const c=1&f.value,l=(f.value>>1&255)+(c<<7);n.flags.CY=c,n.flags.H=0,n.flags.isResultZero=l===0,n.flags.N=0,f.value=l}})}),s.addCbOperation({instruction:"RRC (HL)",byteDefinition:14,cycleTime:4,byteLength:2,execute(){const f=r.memory.readByte(n.HL.value),u=1&f,c=(f>>1&255)+(u<<7);n.flags.CY=u,n.flags.H=0,n.flags.isResultZero=c===0,n.flags.N=0,r.memory.writeByte(n.HL.value,c)}}),n.baseRegisters.forEach(f=>{var u;s.addCbOperation({instruction:`RR ${f.name}`,byteDefinition:(u=f.code,24+u),cycleTime:2,byteLength:2,execute(){const c=1&f.value,l=(f.value>>1&255)+(n.flags.CY<<7);n.flags.isResultZero=l===0,n.flags.CY=c,n.flags.H=0,n.flags.N=0,f.value=l}})}),s.addCbOperation({instruction:"RR (HL)",byteDefinition:30,cycleTime:4,byteLength:2,execute(){const f=r.memory.readByte(n.HL.value),u=1&f,c=(f>>1&255)+(n.flags.CY<<7);n.flags.isResultZero=c===0,n.flags.CY=u,n.flags.H=0,n.flags.N=0,r.memory.writeByte(n.HL.value,c)}}),n.baseRegisters.forEach(f=>{var u;s.addCbOperation({instruction:`SLA ${f.name}`,byteDefinition:(u=f.code,32+u),cycleTime:2,byteLength:2,execute(){const c=f.value>>7,l=f.value<<1&255;n.flags.isResultZero=l===0,n.flags.CY=c,n.flags.H=0,n.flags.N=0,f.value=l}})}),s.addCbOperation({instruction:"SLA (HL)",byteDefinition:38,cycleTime:4,byteLength:2,execute(){const f=r.memory.readByte(n.HL.value),u=f>>7,c=f<<1&255;n.flags.isResultZero=c===0,n.flags.CY=u,n.flags.H=0,n.flags.N=0,r.memory.writeByte(n.HL.value,c)}}),n.baseRegisters.forEach(f=>{var u;s.addCbOperation({instruction:`SRA ${f.name}`,byteDefinition:(u=f.code,40+u),cycleTime:2,byteLength:2,execute(){const c=1&f.value,l=f.value>>7,m=f.value>>1&255,b=e.setBit(m,7,l);n.flags.isResultZero=b===0,n.flags.CY=c,n.flags.H=0,n.flags.N=0,f.value=b}})}),s.addCbOperation({instruction:"SRA (HL)",byteDefinition:46,cycleTime:4,byteLength:2,execute(){const f=r.memory.readByte(n.HL.value),u=1&f,c=f>>7,l=f>>1&255,m=e.setBit(l,7,c);n.flags.isResultZero=m===0,n.flags.CY=u,n.flags.H=0,n.flags.N=0,r.memory.writeByte(n.HL.value,m)}}),n.baseRegisters.forEach(f=>{var u;s.addCbOperation({instruction:`SRL ${f.name}`,byteDefinition:(u=f.code,56+u),cycleTime:2,byteLength:2,execute(){const c=1&f.value,l=f.value>>1&255;n.flags.isResultZero=l===0,n.flags.CY=c,n.flags.H=0,n.flags.N=0,f.value=l}})}),s.addCbOperation({instruction:"SRL (HL)",byteDefinition:62,cycleTime:4,byteLength:2,execute(){const f=r.memory.readByte(n.HL.value),u=1&f,c=f>>1&255;n.flags.isResultZero=c===0,n.flags.CY=u,n.flags.H=0,n.flags.N=0,r.memory.writeByte(n.HL.value,c)}})}},6782:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSetSubOperations=void 0;const r=i(5425),e=i(8254);t.getSetSubOperations=function(s){const{registers:n}=s;function d(u,c){return 192+(u<<3)+c}function f(u){return 192+(u<<3)+6}s.registers.baseRegisters.forEach(u=>{for(let c=0;c<8;c++)s.addCbOperation({byteDefinition:d(c,u.code),instruction:`SET ${c}, ${u.name}`,cycleTime:2,byteLength:2,execute(){u.value=r.setBit(u.value,c,1)}})});for(let u=0;u<8;u++)s.addCbOperation({byteDefinition:f(u),instruction:`SET ${u}, (HL)`,cycleTime:3,byteLength:2,execute(){const c=e.memory.readByte(n.HL.value),l=r.setBit(c,u,1);e.memory.writeByte(n.HL.value,l)}})}},3739:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createArithmeticOperations=void 0;const r=i(8254);t.createArithmeticOperations=function(){const{registers:e}=this;function s(l,m){const b=l+m&255;return e.flags.isResultZero=b===0,e.flags.isHalfCarry=(15&b)<(15&l),e.flags.isSubtraction=!1,e.flags.isCarry=b<l,b}function n(l,m,b){const A=l+m+b&255;return e.flags.isResultZero=A===0,e.flags.isHalfCarry=(15&l)+(15&m)+b>15,e.flags.isSubtraction=!1,e.flags.isCarry=A<l+b,A}function d(l){const m=l-1&255;return e.flags.isResultZero=m===0,e.flags.isHalfCarry=(15&m)>(15&l),e.flags.isSubtraction=!0,m}function f(l){const m=l+1&255;return e.flags.isHalfCarry=(15&m)<(15&l),e.flags.isSubtraction=!1,e.flags.isResultZero=m===0,m}function u(l,m){const b=l-m&255;return e.flags.isResultZero=b===0,e.flags.isSubtraction=!0,e.flags.isHalfCarry=(15&b)>(15&l),e.flags.isCarry=b>l,b}function c(l,m,b){const A=l-m-b&255;return e.flags.isResultZero=A===0,e.flags.isHalfCarry=(15&l)-(15&m)-b<0,e.flags.isSubtraction=!0,e.flags.isCarry=A>l-b,A}this.registers.baseRegisters.forEach(l=>{var m;this.addOperation({byteDefinition:(m=l.code,128+m),cycleTime:1,byteLength:1,get instruction(){return`ADD A, ${l.name}`},execute(){e.A.value=s(e.A.value,l.value)}})}),this.addOperation({byteDefinition:198,cycleTime:2,byteLength:2,get instruction(){return`ADD A, 0x${r.memory.readByte(e.programCounter.value).toString(16)}`},execute(){const l=r.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=s(e.A.value,l)}}),this.addOperation({byteDefinition:134,cycleTime:2,byteLength:1,instruction:"ADD A, (HL)",execute(){const l=r.memory.readByte(e.HL.value);e.A.value=s(e.A.value,l)}}),this.registers.baseRegisters.forEach(l=>{var m;this.addOperation({byteDefinition:(m=l.code,136+m),instruction:`ADC A, ${l.name}`,cycleTime:1,byteLength:1,execute(){e.A.value=n(e.A.value,l.value,255&e.flags.CY)}})}),this.addOperation({byteDefinition:206,cycleTime:2,byteLength:2,get instruction(){return`ADC A, 0x${r.memory.readByte(e.programCounter.value).toString(16)}`},execute(){const l=r.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=n(e.A.value,l,e.flags.CY)}}),this.addOperation({byteDefinition:142,cycleTime:2,byteLength:1,instruction:"ADC A, (HL)",execute(){const l=r.memory.readByte(e.HL.value);e.A.value=n(e.A.value,l,e.flags.CY)}}),e.registerPairs.filter(l=>l.name!=="AF").forEach(l=>{var m;this.addOperation({instruction:`ADD HL, ${l.name}`,byteDefinition:(m=l.code,9+(m<<4)),cycleTime:2,byteLength:1,execute(){e.HL.value=function(b,A){const S=b+A&65535;return e.flags.isHalfCarry=(4095&S)<(4095&b),e.flags.isSubtraction=!1,e.flags.isCarry=S<b,S}(e.HL.value,l.value)}})}),this.addOperation({byteDefinition:232,cycleTime:4,byteLength:2,get instruction(){const l=r.memory.readSignedByte(e.programCounter.value);return l>=0?`ADD SP, 0x${l.toString(16)}`:`ADD SP, -0x${(-1*l).toString(16)}`},execute(){const l=r.memory.readSignedByte(e.programCounter.value);e.programCounter.value++;const m=15-(15&e.stackPointer.value),b=255-(255&e.stackPointer.value);e.flags.isHalfCarry=(15&l)>m,e.flags.isCarry=(255&l)>b,e.flags.isResultZero=!1,e.flags.isSubtraction=!1,e.stackPointer.value=e.stackPointer.value+l}}),this.registers.baseRegisters.forEach(l=>{var m;this.addOperation({instruction:`DEC ${l.name}`,byteDefinition:(m=l.code,5+(m<<3)),cycleTime:1,byteLength:1,execute(){l.value=d(l.value)}})}),this.addOperation({instruction:"DEC (HL)",byteDefinition:53,cycleTime:3,byteLength:1,execute(){const l=d(r.memory.readByte(e.HL.value));r.memory.writeByte(e.HL.value,l)}}),e.registerPairs.filter(l=>l.name!=="AF").forEach(l=>{var m;this.addOperation({instruction:`DEC ${l.name}`,byteDefinition:(m=l.code,11+(m<<4)),cycleTime:2,byteLength:1,execute(){l.value--}})}),this.registers.baseRegisters.forEach(l=>{var m;this.addOperation({byteDefinition:(m=l.code,4+(m<<3)),cycleTime:1,byteLength:1,instruction:`INC ${l.name}`,execute(){l.value=f(l.value)}})}),this.addOperation({byteDefinition:52,cycleTime:3,byteLength:1,instruction:"INC (HL)",execute(){const l=f(r.memory.readByte(e.HL.value));r.memory.writeByte(e.HL.value,l)}}),e.registerPairs.filter(l=>l.name!=="AF").forEach(l=>{var m;this.addOperation({byteDefinition:(m=l.code,3+(m<<4)),cycleTime:2,byteLength:1,instruction:`INC ${l.name}`,execute(){l.value++}})}),this.registers.baseRegisters.forEach(l=>{var m;this.addOperation({byteDefinition:(m=l.code,144+m),cycleTime:1,byteLength:1,instruction:`SUB ${l.name}`,execute(){e.A.value=u(e.A.value,l.value)}})}),this.addOperation({byteDefinition:214,cycleTime:2,byteLength:2,get instruction(){return`SUB 0x${r.memory.readByte(e.programCounter.value).toString(16)}`},execute(){const l=r.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=u(e.A.value,l)}}),this.addOperation({byteDefinition:150,cycleTime:2,byteLength:1,instruction:"SUB (HL)",execute(){const l=r.memory.readByte(e.HL.value);e.A.value=u(e.A.value,l)}}),this.registers.baseRegisters.forEach(l=>{var m;this.addOperation({byteDefinition:(m=l.code,152+m),cycleTime:1,byteLength:1,instruction:`SBC A, ${l.name}`,execute(){e.A.value=c(e.A.value,l.value,e.flags.CY)}})}),this.addOperation({get instruction(){return`SBC 0x${r.memory.readByte(e.programCounter.value).toString(16)}`},byteDefinition:222,cycleTime:2,byteLength:2,execute(){const l=r.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=c(e.A.value,l,e.flags.CY)}}),this.addOperation({instruction:"SBC A, (HL)",byteDefinition:158,cycleTime:2,byteLength:1,execute(){const l=r.memory.readByte(e.HL.value);e.A.value=c(e.A.value,l,e.flags.CY)}})}},7294:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createCallAndReturnOperations=void 0;const r=i(8254);var e;(function(s){s[s.NZ=0]="NZ",s[s.Z=1]="Z",s[s.NC=2]="NC",s[s.C=3]="C"})(e||(e={})),t.createCallAndReturnOperations=function(){const{registers:s}=this,n=this;function d(l){return 192+(l<<3)+4}function f(l){return 192+(l<<3)}function u(l){return 192+(l<<3)+7}this.addOperation({get instruction(){return`CALL 0x${r.memory.readWord(s.programCounter.value).toString(16)}`},byteDefinition:205,byteLength:3,cycleTime:6,execute(){const l=r.memory.readWord(s.programCounter.value);s.programCounter.value+=2;const m=s.programCounter.value;n.pushToStack(m),s.programCounter.value=l}}),this.addOperation({get instruction(){return`CALL NZ, 0x${r.memory.readWord(s.programCounter.value).toString(16)}`},byteDefinition:d(e.NZ),byteLength:3,get cycleTime(){return s.flags.isResultZero?3:6},execute(){if(s.flags.isResultZero)s.programCounter.value+=2;else{const l=r.memory.readWord(s.programCounter.value);s.programCounter.value+=2;const m=s.programCounter.value;n.pushToStack(m),s.programCounter.value=l}}}),this.addOperation({get instruction(){return`CALL Z, 0x${r.memory.readWord(s.programCounter.value).toString(16)}`},byteDefinition:d(e.Z),byteLength:3,get cycleTime(){return s.flags.isResultZero?6:3},execute(){if(s.flags.isResultZero){const l=r.memory.readWord(s.programCounter.value);s.programCounter.value+=2;const m=s.programCounter.value;n.pushToStack(m),s.programCounter.value=l}else s.programCounter.value+=2}}),this.addOperation({get instruction(){return`CALL NC, 0x${r.memory.readWord(s.programCounter.value).toString(16)}`},byteDefinition:d(e.NC),byteLength:3,get cycleTime(){return s.flags.isCarry?3:6},execute(){if(s.flags.isCarry)s.programCounter.value+=2;else{const l=r.memory.readWord(s.programCounter.value);s.programCounter.value+=2;const m=s.programCounter.value;n.pushToStack(m),s.programCounter.value=l}}}),this.addOperation({get instruction(){return`CALL C, 0x${r.memory.readWord(s.programCounter.value).toString(16)}`},byteDefinition:d(e.C),byteLength:3,get cycleTime(){return s.flags.isCarry?6:3},execute(){if(s.flags.isCarry){const l=r.memory.readWord(s.programCounter.value);s.programCounter.value+=2;const m=s.programCounter.value;n.pushToStack(m),s.programCounter.value=l}else s.programCounter.value+=2}}),this.addOperation({instruction:"RET",byteDefinition:201,byteLength:1,cycleTime:4,execute(){s.programCounter.value=n.popFromStack()}}),this.addOperation({instruction:"RETI",byteDefinition:217,byteLength:1,cycleTime:4,execute(){s.programCounter.value=n.popFromStack(),n.isInterruptMasterEnable=!0}}),this.addOperation({instruction:"RET NZ",byteDefinition:f(e.NZ),byteLength:1,get cycleTime(){return s.flags.isResultZero?2:5},execute(){s.flags.isResultZero||(s.programCounter.value=n.popFromStack())}}),this.addOperation({instruction:"RET Z",byteDefinition:f(e.Z),byteLength:1,get cycleTime(){return s.flags.isResultZero?5:2},execute(){s.flags.isResultZero&&(s.programCounter.value=n.popFromStack())}}),this.addOperation({instruction:"RET NC",byteDefinition:f(e.NC),byteLength:1,get cycleTime(){return s.flags.isCarry?2:5},execute(){s.flags.isCarry||(s.programCounter.value=n.popFromStack())}}),this.addOperation({instruction:"RET C",byteDefinition:f(e.C),byteLength:1,get cycleTime(){return s.flags.isCarry?5:2},execute(){s.flags.isCarry&&(s.programCounter.value=n.popFromStack())}});const c=[0,8,16,24,32,40,48,56];for(let l=0;l<8;l++)this.addOperation({byteDefinition:u(l),instruction:`RST ${l}`,byteLength:1,cycleTime:4,execute(){n.pushToStack(s.programCounter.value),s.programCounter.value=c[l]}})}},927:(h,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createGeneralPurposeOperations=void 0,t.createGeneralPurposeOperations=function(){const{registers:i}=this;this.addOperation({instruction:"DAA",byteDefinition:39,cycleTime:1,byteLength:1,execute(){const{A:r,flags:e}=i,s=e.isSubtraction?-6:6,n=e.isSubtraction?-96:96,d=!e.isSubtraction&&(15&r.value)>9,f=!e.isSubtraction&&r.value>153;(e.isHalfCarry||d)&&(r.value+=s),(e.isCarry||f)&&(r.value+=n,e.isCarry=!0),e.isResultZero=r.value===0,e.isHalfCarry=!1}}),this.addOperation({instruction:"CPL",byteDefinition:47,cycleTime:1,byteLength:1,execute(){i.A.value=~i.A.value,i.flags.isHalfCarry=!0,i.flags.isSubtraction=!0}}),this.addOperation({instruction:"NOP",byteDefinition:0,cycleTime:1,byteLength:1,execute(){}}),this.addOperation({instruction:"CCF",byteDefinition:63,cycleTime:1,byteLength:1,execute(){i.flags.isSubtraction=!1,i.flags.isHalfCarry=!1,i.flags.isCarry=!i.flags.isCarry}}),this.addOperation({instruction:"SCF",byteDefinition:55,cycleTime:1,byteLength:1,execute(){i.flags.isSubtraction=!1,i.flags.isHalfCarry=!1,i.flags.isCarry=!0}}),this.addOperation({instruction:"HALT",byteDefinition:118,cycleTime:1,byteLength:1,execute:()=>{this.halt()}}),this.addOperation({instruction:"STOP",byteDefinition:16,cycleTime:1,byteLength:1,execute:()=>{this.stop()}})}},9904:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createInputOutputOperations=void 0;const r=i(8254);t.createInputOutputOperations=function(){const{registers:e}=this;this.registers.baseRegisters.forEach(s=>{var n;this.addOperation({byteDefinition:(n=s.code,64+(n<<3)+6),instruction:`LD ${s.name}, (HL)`,cycleTime:2,byteLength:1,execute(){s.value=r.memory.readByte(e.HL.value)}})}),this.addOperation({instruction:"LD A, (BC)",byteDefinition:10,cycleTime:2,byteLength:1,execute(){e.A.value=r.memory.readByte(e.BC.value)}}),this.addOperation({instruction:"LD A, (DE)",byteDefinition:26,cycleTime:2,byteLength:1,execute(){e.A.value=r.memory.readByte(e.DE.value)}}),this.addOperation({instruction:"LD A, (C)",byteDefinition:242,cycleTime:2,byteLength:1,execute(){e.A.value=r.memory.readByte(65280+e.C.value)}}),this.addOperation({get instruction(){return`LD A, (0x${r.memory.readByte(e.programCounter.value).toString(16)})`},byteDefinition:240,cycleTime:3,byteLength:2,execute(){const s=r.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=r.memory.readByte(65280+s)}}),this.addOperation({get instruction(){return`LD A, (0x${r.memory.readWord(e.programCounter.value).toString(16)})`},byteDefinition:250,cycleTime:4,byteLength:3,execute(){const s=r.memory.readWord(e.programCounter.value);e.programCounter.value+=2,e.A.value=r.memory.readByte(s)}}),this.addOperation({instruction:"LD A, (HLI)",byteDefinition:42,cycleTime:2,byteLength:1,execute(){e.A.value=r.memory.readByte(e.HL.value),e.HL.value++}}),this.addOperation({instruction:"LD A, (HLD)",byteDefinition:58,cycleTime:2,byteLength:1,execute(){e.A.value=r.memory.readByte(e.HL.value),e.HL.value--}}),this.registers.baseRegisters.forEach(s=>{var n;this.addOperation({byteDefinition:(n=s.code,112+n),instruction:`LD (HL), ${s.name}`,cycleTime:2,byteLength:1,execute(){r.memory.writeByte(e.HL.value,s.value)}})}),this.addOperation({instruction:"LD (C), A",byteDefinition:226,cycleTime:2,byteLength:1,execute(){r.memory.writeByte(65280+e.C.value,e.A.value)}}),this.addOperation({get instruction(){return`LD (0x${r.memory.readByte(e.programCounter.value).toString(16)}), A`},byteDefinition:224,cycleTime:3,byteLength:2,execute(){const s=r.memory.readByte(e.programCounter.value);e.programCounter.value++,r.memory.writeByte(65280+s,e.A.value)}}),this.addOperation({get instruction(){return`LD (0x${r.memory.readWord(e.programCounter.value).toString(16)}), A`},byteDefinition:234,cycleTime:4,byteLength:3,execute(){const s=r.memory.readWord(e.programCounter.value);e.programCounter.value+=2,r.memory.writeByte(s,e.A.value)}}),this.addOperation({instruction:"LD (BC), A",byteDefinition:2,cycleTime:2,byteLength:1,execute(){r.memory.writeByte(e.BC.value,e.A.value)}}),this.addOperation({instruction:"LD (DE), A",byteDefinition:18,cycleTime:2,byteLength:1,execute(){r.memory.writeByte(e.DE.value,e.A.value)}}),this.addOperation({instruction:"LD (HLI), A",byteDefinition:34,cycleTime:2,byteLength:1,execute(){r.memory.writeByte(e.HL.value,e.A.value),e.HL.value=e.HL.value+1}}),this.addOperation({instruction:"LD (HLD), A",byteDefinition:50,cycleTime:2,byteLength:1,execute(){r.memory.writeByte(e.HL.value,e.A.value),e.HL.value=e.HL.value-1}}),e.baseRegisters.forEach(s=>{e.baseRegisters.forEach(n=>{var d,f;this.addOperation({byteDefinition:(d=s.code,f=n.code,64+(d<<3)+f),instruction:`LD ${s.name}, ${n.name}`,byteLength:1,cycleTime:2,execute(){s.value=n.value}})})}),this.addOperation({get instruction(){return`LD (HL), 0x${r.memory.readByte(e.programCounter.value).toString(16)}`},byteDefinition:54,cycleTime:3,byteLength:2,execute(){const s=r.memory.readByte(e.programCounter.value);e.programCounter.value++,r.memory.writeByte(e.HL.value,s)}}),this.registers.baseRegisters.forEach(s=>{var n;this.addOperation({get instruction(){return`LD ${s.name}, 0x${r.memory.readByte(e.programCounter.value).toString(16)}`},byteDefinition:(n=s.code,6+(n<<3)),cycleTime:2,byteLength:2,execute(){s.value=r.memory.readByte(e.programCounter.value),e.programCounter.value++}})}),this.addOperation({get instruction(){return`LD (0x${r.memory.readWord(e.programCounter.value).toString(16)}), SP`},byteDefinition:8,cycleTime:5,byteLength:3,execute(){const s=r.memory.readWord(e.programCounter.value);r.memory.writeWord(s,e.stackPointer.value),e.programCounter.value+=2}}),e.registerPairs.filter(s=>s.name!=="AF").forEach(s=>{var n;this.addOperation({get instruction(){return`LD ${s.name}, 0x${r.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:(n=s.code,1+(n<<4)),cycleTime:3,byteLength:3,execute(){s.value=r.memory.readWord(e.programCounter.value),e.programCounter.value+=2}})}),this.addOperation({instruction:"LD SP, HL",byteDefinition:249,cycleTime:2,byteLength:1,execute(){e.stackPointer.value=e.HL.value}}),e.registerPairs.filter(s=>s.name!=="SP").forEach(s=>{var n;this.addOperation({instruction:`PUSH ${s.name}`,byteDefinition:(n=s.code,192+(n<<4)+5),byteLength:1,cycleTime:4,execute:()=>{this.pushToStack(s.value)}})}),e.registerPairs.filter(s=>s.name!=="SP").forEach(s=>{var n;this.addOperation({instruction:`POP ${s.name}`,byteDefinition:(n=s.code,192+(n<<4)+1),byteLength:1,cycleTime:3,execute:()=>{s.value=this.popFromStack()}})}),this.addOperation({byteDefinition:248,get instruction(){const s=r.memory.readSignedByte(e.programCounter.value);return s>=0?`LDHL SP,  0x${s.toString(16)}`:`LDHL SP,  -0x${(-1*s).toString(16)}`},byteLength:2,cycleTime:3,execute(){const s=r.memory.readSignedByte(e.programCounter.value);e.programCounter.value++;const n=15-(15&e.stackPointer.value),d=255-(255&e.stackPointer.value);e.flags.isHalfCarry=(15&s)>n,e.flags.isCarry=(255&s)>d,e.flags.isResultZero=!1,e.flags.isSubtraction=!1,e.HL.value=e.stackPointer.value+s}})}},5494:(h,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createInterruptOperations=void 0,t.createInterruptOperations=function(){const i=this;this.addOperation({instruction:"EI",byteDefinition:251,byteLength:1,cycleTime:1,execute(){i.isInterruptMasterEnable=!0}}),this.addOperation({instruction:"DI",byteDefinition:243,byteLength:1,cycleTime:1,execute(){i.isInterruptMasterEnable=!1}})}},1456:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createJumpOperations=void 0;const r=i(8254);t.createJumpOperations=function(){const{registers:e}=this;this.addOperation({get instruction(){return`JP 0x${r.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:195,cycleTime:4,byteLength:3,execute(){e.programCounter.value=r.memory.readWord(e.programCounter.value)}}),this.addOperation({get instruction(){return`JP NZ, 0x${r.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:194,get cycleTime(){return e.flags.isResultZero?3:4},byteLength:3,execute(){e.flags.isResultZero?e.programCounter.value+=2:e.programCounter.value=r.memory.readWord(e.programCounter.value)}}),this.addOperation({get instruction(){return`JP Z, 0x${r.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:202,get cycleTime(){return e.flags.isResultZero?4:3},byteLength:3,execute(){e.flags.isResultZero?e.programCounter.value=r.memory.readWord(e.programCounter.value):e.programCounter.value+=2}}),this.addOperation({get instruction(){return`JP NC, 0x${r.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:210,get cycleTime(){return e.flags.isCarry?3:4},byteLength:3,execute(){e.flags.isCarry?e.programCounter.value+=2:e.programCounter.value=r.memory.readWord(e.programCounter.value)}}),this.addOperation({get instruction(){return`JP C, 0x${r.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:218,get cycleTime(){return e.flags.isCarry?4:3},byteLength:3,execute(){e.flags.isCarry?e.programCounter.value=r.memory.readWord(e.programCounter.value):e.programCounter.value+=2}}),this.addOperation({get instruction(){const s=r.memory.readSignedByte(e.programCounter.value);return s>=0?`JR 0x${s.toString(16)}`:`JR -0x${(-1*s).toString(16)}`},byteDefinition:24,cycleTime:3,byteLength:2,execute(){const s=r.memory.readSignedByte(e.programCounter.value);e.programCounter.value++,e.programCounter.value=e.programCounter.value+s}}),this.addOperation({get instruction(){const s=r.memory.readSignedByte(e.programCounter.value);return s>=0?`JR NZ 0x${s.toString(16)}`:`JR NZ -0x${(-1*s).toString(16)}`},byteDefinition:32,cycleTime:e.flags.isResultZero?2:3,byteLength:2,execute(){if(e.flags.isResultZero)e.programCounter.value++;else{const s=r.memory.readSignedByte(e.programCounter.value);e.programCounter.value++,e.programCounter.value=e.programCounter.value+s}}}),this.addOperation({get instruction(){const s=r.memory.readSignedByte(e.programCounter.value);return s>=0?`JR Z 0x${s.toString(16)}`:`JR Z -0x${(-1*s).toString(16)}`},byteDefinition:40,cycleTime:e.flags.isResultZero?3:2,byteLength:2,execute(){if(e.flags.isResultZero){const s=r.memory.readSignedByte(e.programCounter.value);e.programCounter.value++,e.programCounter.value=e.programCounter.value+s}else e.programCounter.value++}}),this.addOperation({get instruction(){const s=r.memory.readSignedByte(e.programCounter.value);return s>=0?`JR NC 0x${s.toString(16)}`:`JR NC -0x${(-1*s).toString(16)}`},byteDefinition:48,cycleTime:e.flags.isCarry?2:3,byteLength:2,execute(){if(e.flags.isCarry)e.programCounter.value++;else{const s=r.memory.readSignedByte(e.programCounter.value);e.programCounter.value++,e.programCounter.value=e.programCounter.value+s}}}),this.addOperation({get instruction(){const s=r.memory.readSignedByte(e.programCounter.value);return s>=0?`JR C 0x${s.toString(16)}`:`JR C -0x${(-1*s).toString(16)}`},byteDefinition:56,cycleTime:e.flags.isCarry?3:2,byteLength:2,execute(){if(e.flags.isCarry){const s=r.memory.readSignedByte(e.programCounter.value);e.programCounter.value++,e.programCounter.value=e.programCounter.value+s}else e.programCounter.value++}}),this.addOperation({instruction:" JP (HL)",byteDefinition:233,cycleTime:1,byteLength:1,execute(){e.programCounter.value=e.HL.value}})}},7300:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createLogicalOperations=void 0;const r=i(8254);t.createLogicalOperations=function(){const{registers:e}=this;function s(u,c){const l=u&c&255;return e.flags.isCarry=!1,e.flags.isHalfCarry=!0,e.flags.isSubtraction=!1,e.flags.isResultZero=l===0,l}function n(u,c){const l=u-c&255;e.flags.isResultZero=l===0,e.flags.isHalfCarry=(15&u)<(15&c),e.flags.isSubtraction=!0,e.flags.isCarry=u<c}function d(u,c){const l=255&(u|c);return e.flags.isCarry=!1,e.flags.isHalfCarry=!1,e.flags.isSubtraction=!1,e.flags.isResultZero=l===0,l}function f(u,c){const l=255&(u^c);return e.flags.isCarry=!1,e.flags.isHalfCarry=!1,e.flags.isSubtraction=!1,e.flags.isResultZero=l===0,l}this.registers.baseRegisters.forEach(u=>{var c;this.addOperation({byteDefinition:(c=u.code,160+c),cycleTime:1,byteLength:1,instruction:`AND ${u.name}`,execute(){e.A.value=s(e.A.value,u.value)}})}),this.addOperation({byteDefinition:230,cycleTime:2,byteLength:2,get instruction(){return`AND 0x${r.memory.readByte(e.programCounter.value).toString(16)}`},execute(){const u=r.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=s(e.A.value,u)}}),this.addOperation({byteDefinition:166,cycleTime:2,byteLength:1,get instruction(){return`AND 0x${r.memory.readByte(e.HL.value).toString(16)}`},execute(){const u=r.memory.readByte(e.HL.value);e.A.value=s(e.A.value,u)}}),this.registers.baseRegisters.forEach(u=>{var c;this.addOperation({instruction:`CP ${u.name}`,byteDefinition:(c=u.code,184+c),cycleTime:1,byteLength:1,execute(){n(e.A.value,u.value)}})}),this.addOperation({get instruction(){return`CP 0x${r.memory.readByte(e.programCounter.value).toString(16)}`},byteDefinition:254,cycleTime:2,byteLength:2,execute(){const u=r.memory.readByte(e.programCounter.value);e.programCounter.value++,n(e.A.value,u)}}),this.addOperation({instruction:"CP (HL)",byteDefinition:190,cycleTime:2,byteLength:1,execute(){const u=r.memory.readByte(e.HL.value);n(e.A.value,u)}}),this.registers.baseRegisters.forEach(u=>{var c;this.addOperation({byteDefinition:(c=u.code,176+c),cycleTime:1,byteLength:1,instruction:`OR ${u.name}`,execute(){e.A.value=d(e.A.value,u.value)}})}),this.addOperation({byteDefinition:246,cycleTime:2,byteLength:2,get instruction(){return`OR 0x${r.memory.readByte(e.programCounter.value).toString(16)}`},execute(){const u=r.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=d(e.A.value,u)}}),this.addOperation({byteDefinition:182,cycleTime:2,byteLength:1,instruction:"OR (HL)",execute(){const u=r.memory.readByte(e.HL.value);e.A.value=d(e.A.value,u)}}),this.registers.baseRegisters.forEach(u=>{var c;this.addOperation({instruction:`XOR ${u.name}`,byteDefinition:(c=u.code,168+c),cycleTime:1,byteLength:1,execute(){e.A.value=f(e.A.value,u.value)}})}),this.addOperation({get instruction(){return`XOR 0x${r.memory.readByte(e.programCounter.value).toString(16)}`},byteDefinition:238,cycleTime:2,byteLength:2,execute(){const u=r.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=f(e.A.value,u)}}),this.addOperation({instruction:"XOR (HL)",byteDefinition:174,cycleTime:2,byteLength:1,execute(){const u=r.memory.readByte(e.HL.value);e.A.value=f(e.A.value,u)}})}},9879:(h,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createRotateShiftOperations=void 0,t.createRotateShiftOperations=function(){const{registers:i}=this;this.addOperation({instruction:"RLCA",byteDefinition:7,cycleTime:1,byteLength:1,execute(){const r=i.A.value>>7;i.flags.CY=r,i.flags.H=0,i.flags.Z=0,i.flags.N=0,i.A.value=(i.A.value<<1)+r}}),this.addOperation({instruction:"RLA",byteDefinition:23,cycleTime:1,byteLength:1,execute(){const r=i.A.value>>7,e=(i.A.value<<1)+i.flags.CY;i.flags.CY=r,i.flags.H=0,i.flags.N=0,i.flags.Z=0,i.A.value=e}}),this.addOperation({instruction:"RRCA",byteDefinition:15,cycleTime:1,byteLength:1,execute(){const r=1&i.A.value;i.flags.CY=r,i.flags.H=0,i.flags.Z=0,i.flags.N=0,i.A.value=(i.A.value>>1)+(r<<7)}}),this.addOperation({instruction:"RRA",byteDefinition:31,cycleTime:1,byteLength:1,execute(){const r=1&i.A.value,e=(i.A.value>>1)+(i.flags.CY<<7);i.flags.CY=r,i.flags.H=0,i.flags.N=0,i.flags.Z=0,i.A.value=e}})}},9080:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dividerRegister=t.DividerRegister=void 0;const r=i(8254);class e{constructor(){this.offset=65284,this.name="DIV"}setValueFromCpuDivider(n){r.memory.writeByte(this.offset,n)}get value(){return r.memory.readByte(this.offset)}set value(n){r.memory.writeByte(this.offset,0)}}t.DividerRegister=e,t.dividerRegister=new e},9099:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.interruptEnableRegister=void 0;const r=i(8254);t.interruptEnableRegister=new class{constructor(){this.offset=65535,this.name="IE"}get value(){return r.memory.readByte(this.offset)}set value(e){r.memory.writeByte(this.offset,e)}}},8543:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.interruptRequestRegister=void 0;const r=i(8254),e=i(5425);t.interruptRequestRegister=new class{constructor(){this.offset=65295,this.name="IF"}get value(){return r.memory.readByte(this.offset)}set value(s){r.memory.writeByte(this.offset,s)}triggerVBlankInterruptRequest(){this.value=e.setBit(this.value,0,1)}triggerLcdStatusInterruptRequest(){this.value=e.setBit(this.value,1,1)}triggerTimerInterruptRequest(){this.value=e.setBit(this.value,2,1)}clearVBlankInterruptRequest(){this.value=e.clearBit(this.value,0)}clearLcdStatusInterruptRequest(){this.value=e.clearBit(this.value,1)}clearTimerOverflowInterruptRequest(){this.value=e.clearBit(this.value,2)}clearSerialTransferInterruptRequest(){this.value=e.clearBit(this.value,3)}clearP10P13NegativeEdgeInterruptRequest(){this.value=e.clearBit(this.value,4)}getInterruptFlags(s){return{isVerticalBlanking:(1&s)==1,isLCDStatus:(s>>1&1)==1,isTimerOverflow:(s>>2&1)==1,isSerialTransferCompletion:(s>>3&1)==1,isP10P13NegativeEdge:(s>>4&1)==1}}}},6584:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.timerControllerRegister=void 0;const r=i(8254);t.timerControllerRegister=new class{constructor(){this.offset=65287,this.name="TAC",this.inputClockSpeedValueToCycles=[1024,16,64,256]}get value(){return r.memory.readByte(this.offset)}set value(e){r.memory.writeByte(this.offset,e)}get inputClockSpeed(){return 3&this.value}get cyclesForTimerUpdate(){return this.inputClockSpeedValueToCycles[this.inputClockSpeed]}get isTimerOn(){return(this.value>>2&1)==1}}},4002:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.timerCounterRegister=t.TimerCounterRegister=void 0;const r=i(8254);class e{constructor(){this.offset=65285,this.name="TIMA"}get value(){return r.memory.readByte(this.offset)}set value(n){r.memory.writeByte(this.offset,n)}}t.TimerCounterRegister=e,t.timerCounterRegister=new e},3120:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.timerModuloRegister=t.TimerModuloRegister=void 0;const r=i(8254);class e{constructor(){this.offset=65286,this.name="TMA"}get value(){return r.memory.readByte(this.offset)}set value(n){r.memory.writeByte(this.offset,n)}}t.TimerModuloRegister=e,t.timerModuloRegister=new e},1007:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GPU=void 0;const r=i(8254),e=i(4311),s=i(5425),n=i(2169),d=i(6681),f=i(1388),u=i(1659),c=i(8947),l=i(46),m=i(8224),b=i(3069),A=i(6396),S=i(2806),k=i(6685),x=i(8958),F=i(8543);class C{constructor(){this.cycleCounter=0,this.windowLinesDrawn=0,this.colors=[{red:255,green:255,blue:255},{red:192,green:192,blue:192},{red:96,green:96,blue:96},{red:0,green:0,blue:0}],this.screen=new e.EnhancedImageData(C.ScreenWidth,C.ScreenHeight)}tick(P){switch(this.cycleCounter+=P,u.lcdStatusRegister.mode){case n.LcdStatusMode.SearchingOAM:this.cycleCounter>=C.CyclesPerScanlineOam&&(this.cycleCounter%=C.CyclesPerScanlineOam,u.lcdStatusRegister.mode=n.LcdStatusMode.TransferringDataToLCD);break;case n.LcdStatusMode.TransferringDataToLCD:this.cycleCounter>=C.CyclesPerScanlineVram&&(this.cycleCounter%=C.CyclesPerScanlineVram,u.lcdStatusRegister.isHBlankInterruptSelected&&F.interruptRequestRegister.triggerLcdStatusInterruptRequest(),u.lcdStatusRegister.isLineYCompareMatching=c.lineYRegister.value===l.lineYCompareRegister.value,u.lcdStatusRegister.isLineYMatchingInterruptSelected&&u.lcdStatusRegister.isLineYCompareMatching&&F.interruptRequestRegister.triggerLcdStatusInterruptRequest(),u.lcdStatusRegister.mode=n.LcdStatusMode.InHBlank);break;case n.LcdStatusMode.InHBlank:this.cycleCounter>=C.CyclesPerHBlank&&(this.drawScanline(),this.cycleCounter%=C.CyclesPerHBlank,c.lineYRegister.value++,c.lineYRegister.value===C.ScreenHeight?(u.lcdStatusRegister.mode=n.LcdStatusMode.InVBlank,F.interruptRequestRegister.triggerVBlankInterruptRequest()):u.lcdStatusRegister.mode=n.LcdStatusMode.SearchingOAM);break;case n.LcdStatusMode.InVBlank:this.cycleCounter>=C.CyclesPerScanline&&(u.lcdStatusRegister.isLineYCompareMatching=c.lineYRegister.value===l.lineYCompareRegister.value,u.lcdStatusRegister.isLineYMatchingInterruptSelected&&u.lcdStatusRegister.isLineYCompareMatching&&F.interruptRequestRegister.triggerLcdStatusInterruptRequest(),c.lineYRegister.value++,this.cycleCounter%=C.CyclesPerScanline,c.lineYRegister.value===C.HeightIncludingOffscreen&&(u.lcdStatusRegister.mode=n.LcdStatusMode.SearchingOAM,c.lineYRegister.value=0,this.windowLinesDrawn=0))}}drawScanline(){if(!m.lcdControlRegister.isLCDControllerOperating)return;let P=[];m.lcdControlRegister.isBackgroundDisplayOn&&(P=this.drawBackgroundLine());let B=[];m.lcdControlRegister.isWindowingOn&&(B=this.drawWindowLine()),m.lcdControlRegister.isObjOn&&this.drawSpriteLine(P,B)}drawBackgroundLine(){const P=[],B=m.lcdControlRegister.backgroundCharacterDataStartAddress,{backgroundTileMapStartAddress:O,backgroundCharacterData:R}=m.lcdControlRegister,T=R===0?r.memory.readSignedByte:r.memory.readByte,D=b.backgroundPaletteRegister.backgroundPalette,M=s.asUint8(c.lineYRegister.value+A.scrollYRegister.value);for(let L=0;L<C.ScreenWidth;L++)if(m.lcdControlRegister.isBackgroundDisplayOn){const W=s.asUint8(L+S.scrollXRegister.value),H=this.getTileIndexFromPixelLocation(W,M),J=this.getUpperLeftPixelLocationOfTile(H),te=W-J.x,ce=2*(M-J.y),fe=m.lcdControlRegister.backgroundCharacterData===0?128:0,q=B+16*(T(O+H)+fe)+ce,re=r.memory.readByte(q),de=r.memory.readByte(q+1),Y=this.getPixelInTileLine(te,re,de,!1);P.push(Y);const X=D[Y],V=this.colors[X];this.screen.setPixel(L,c.lineYRegister.value,V.red,V.green,V.blue)}else{const W=D[0],H=this.colors[W];P.push(0),this.screen.setPixel(L,c.lineYRegister.value,H.red,H.green,H.blue)}return P}drawWindowLine(){if(c.lineYRegister.value<d.windowYRegister.value||f.windowXRegister.value>166)return[];const P=[];let B;const O=m.lcdControlRegister.windowTileMapStartAddress,R=m.lcdControlRegister.backgroundCharacterDataStartAddress,T=b.backgroundPaletteRegister.backgroundPalette;if(m.lcdControlRegister.backgroundCharacterData===0){const L=r.memory.memoryBytes.subarray(O,O+4096);B=new Int8Array(L)}else B=r.memory.memoryBytes.subarray(O,O+4096);const D=this.windowLinesDrawn,M=f.windowXRegister.value-7;for(let L=0;L<C.ScreenWidth;L++){if(L<M){P.push(0);continue}const W=L-M,H=this.getTileIndexFromPixelLocation(W,D),J=this.getUpperLeftPixelLocationOfTile(H),te=W-J.x,ce=2*(D-J.y),fe=m.lcdControlRegister.backgroundCharacterData===0?128:0,q=R+16*(B[H]+fe)+ce,re=r.memory.readByte(q),de=r.memory.readByte(q+1),Y=this.getPixelInTileLine(te,re,de,!1);P.push(Y);const X=T[Y],V=this.colors[X];this.screen.setPixel(L,c.lineYRegister.value,V.red,V.green,V.blue)}return this.windowLinesDrawn++,P}drawSpriteLine(P,B){k.objectAttributeMemoryRegisters.filter(O=>{const{xPosition:R,yPosition:T}=O;if(R===0||T==0||R>=168||T>=160)return!1;const D=T+-16;let M=c.lineYRegister.value-D;const L=m.lcdControlRegister.objectHeight-1;return O.isFlippedVertical&&(M=L-M),M>=0&&M<=L}).slice(0,10).reverse().sort((O,R)=>R.xPosition-O.xPosition).forEach(O=>{const{xPosition:R,yPosition:T,characterCode:D,paletteNumber:M}=O,L=R+-8,W=T+-16;let H=c.lineYRegister.value-W;const J=m.lcdControlRegister.objectHeight-1;O.isFlippedVertical&&(H=J-H);const te=32768+16*(m.lcdControlRegister.objectHeight===16?s.clearBit(D,0):D)+2*H,ce=r.memory.readByte(te),fe=r.memory.readByte(te+1);for(let q=0;q<8;q++){const re=this.getPixelInTileLine(q,ce,fe,O.isFlippedHorizontal),de=x.objectPaletteRegisters[M].palette[re],Y=this.colors[de],X=L+q,V=P[X]!==0,Lt=B[X]!==void 0&&B[X]!==0,Dt=O.isBehindBackground&&(V||Lt);re===0||Dt||this.screen.setPixel(L+q,c.lineYRegister.value,Y.red,Y.green,Y.blue)}})}getTileIndexFromPixelLocation(P,B){const O=Math.floor(P/8);return 32*Math.floor(B/8)+O}getUpperLeftPixelLocationOfTile(P){const B=Math.floor(P/32);return{x:8*(P-32*B),y:8*B}}getPixelInTileLine(P,B,O,R){const T=R?P:7-P;return s.getBit(B,T)+(s.getBit(O,T)<<1)}}t.GPU=C,C.ScreenWidth=160,C.ScreenHeight=144,C.HeightIncludingOffscreen=154,C.CyclesPerHBlank=204,C.CyclesPerScanlineOam=80,C.CyclesPerScanlineVram=172,C.CyclesPerScanline=C.CyclesPerHBlank+C.CyclesPerScanlineOam+C.CyclesPerScanlineVram,C.CyclesPerVBlank=4560,C.ScanlinesPerFrame=144,C.CyclesPerFrame=C.CyclesPerScanline*C.ScanlinesPerFrame+C.CyclesPerVBlank},3069:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.backgroundPaletteRegister=void 0;const r=i(8254);t.backgroundPaletteRegister=new class{constructor(){this.offset=65351,this.name="BGP"}get value(){return r.memory.readByte(this.offset)}set value(e){r.memory.writeByte(this.offset,e)}get backgroundPalette(){const e=this.value;return[3&e,e>>2&3,e>>4&3,e>>6&3]}}},8078:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dmaTransferRegister=void 0;const r=i(8254);t.dmaTransferRegister=new class{constructor(){this.offset=65350,this.name="DMA"}get value(){return r.memory.readByte(this.offset)}}},8224:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.lcdControlRegister=void 0;const r=i(8254),e=i(5425);t.lcdControlRegister=new class{constructor(){this.offset=65344,this.name="LCDC"}get value(){return r.memory.readByte(this.offset)}set value(s){r.memory.writeByte(this.offset,s)}get isBackgroundDisplayOn(){return e.getBit(this.value,0)===1}get isObjOn(){return e.getBit(this.value,1)===1}get objectHeight(){return e.getBit(this.value,2)===0?8:16}get backgroundCodeArea(){return e.getBit(this.value,3)}get backgroundCharacterData(){return e.getBit(this.value,4)}get windowCharacterData(){return this.backgroundCharacterData}get isWindowingOn(){return e.getBit(this.value,5)===1}get windowCodeArea(){return e.getBit(this.value,6)}get windowTileMapStartAddress(){return this.windowCodeArea===0?38912:39936}get backgroundTileMapStartAddress(){return this.backgroundCodeArea===0?38912:39936}get backgroundCharacterDataStartAddress(){return this.backgroundCharacterData===0?34816:32768}get isLCDControllerOperating(){return e.getBit(this.value,7)===1}}},2169:(h,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.LcdStatusMode=void 0,(i=t.LcdStatusMode||(t.LcdStatusMode={}))[i.InHBlank=0]="InHBlank",i[i.InVBlank=1]="InVBlank",i[i.SearchingOAM=2]="SearchingOAM",i[i.TransferringDataToLCD=3]="TransferringDataToLCD"},1659:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.lcdStatusRegister=void 0;const r=i(8254),e=i(5425);t.lcdStatusRegister=new class{constructor(){this.offset=65345,this.name="STAT"}get value(){return r.memory.readByte(this.offset)}set value(s){r.memory.writeByte(this.offset,s)}get mode(){return 3&this.value}set mode(s){let n=this.value;n=e.setBit(n,0,1&s),n=e.setBit(n,1,s>>1&1),this.value=n}get isLineYCompareMatching(){return e.getBit(this.value,2)===1}set isLineYCompareMatching(s){this.value=e.setBit(this.value,2,s?1:0)}get isHBlankInterruptSelected(){return e.getBit(this.value,3)}get isLineYMatchingInterruptSelected(){return e.getBit(this.value,6)}}},46:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.lineYCompareRegister=t.LineYCompareRegister=void 0;const r=i(8254);class e{constructor(){this.offset=65349,this.name="LYC"}get value(){return r.memory.readByte(this.offset)}set value(n){r.memory.writeByte(this.offset,n)}}t.LineYCompareRegister=e,t.lineYCompareRegister=new e},8947:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.lineYRegister=t.LineYRegister=void 0;const r=i(8254);class e{constructor(){this.offset=65348,this.name="LY"}get value(){return r.memory.readByte(this.offset)}set value(n){r.memory.writeByte(this.offset,n)}}t.LineYRegister=e,t.lineYRegister=new e},6685:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectAttributeMemoryRegisters=t.ObjectAttributeMemoryRegister=void 0;const r=i(8254);class e{constructor(n){this.offset=n+e.StartOffset,this.name="OBJ"+n}getValueAt(n){if(n>=e.BytesPerRegister)throw new Error(`${this.name} Index out of bounds`);return r.memory.readByte(this.offset+n)}get yPosition(){return this.getValueAt(0)}get xPosition(){return this.getValueAt(1)}get characterCode(){return this.getValueAt(2)}get paletteNumber(){return this.getValueAt(3)>>4&1}get isFlippedHorizontal(){return(this.getValueAt(3)>>5&1)==1}get isFlippedVertical(){return(this.getValueAt(3)>>6&1)==1}get isBehindBackground(){return(this.getValueAt(3)>>7&1)==1}}t.ObjectAttributeMemoryRegister=e,e.StartOffset=65024,e.EndOffset=65183,e.BytesPerRegister=4,t.objectAttributeMemoryRegisters=function(){const s=[],n=e.EndOffset-e.StartOffset;for(let d=0;d<=n;d+=e.BytesPerRegister)s.push(new e(d));return s}()},8958:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectPaletteRegisters=t.ObjectPaletteRegister=void 0;const r=i(8254);class e{constructor(n){this.offset=e.StartOffset+n,this.name="OBP"+n}get value(){return r.memory.readByte(this.offset)}set value(n){r.memory.writeByte(this.offset,n)}get palette(){const n=this.value;return[3&n,n>>2&3,n>>4&3,n>>6&3]}}t.ObjectPaletteRegister=e,e.StartOffset=65352,t.objectPaletteRegisters=[new e(0),new e(1)]},2806:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scrollXRegister=t.ScrollXRegister=void 0;const r=i(8254);class e{constructor(){this.offset=65347,this.name="SCX"}get value(){return r.memory.readByte(this.offset)}set value(n){r.memory.writeByte(this.offset,n)}}t.ScrollXRegister=e,t.scrollXRegister=new e},6396:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scrollYRegister=t.ScrollYRegister=void 0;const r=i(8254);class e{constructor(){this.offset=65346,this.name="SCY"}get value(){return r.memory.readByte(this.offset)}set value(n){r.memory.writeByte(this.offset,n)}}t.ScrollYRegister=e,t.scrollYRegister=new e},1388:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.windowXRegister=t.WindowXRegister=void 0;const r=i(8254);class e{constructor(){this.offset=65355,this.name="WX"}get value(){return r.memory.readByte(this.offset)}set value(n){r.memory.writeByte(this.offset,n)}}t.WindowXRegister=e,t.windowXRegister=new e},6681:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.windowYRegister=t.WindowYRegister=void 0;const r=i(8254);class e{constructor(){this.offset=65354,this.name="WY"}get value(){return r.memory.readByte(this.offset)}set value(n){r.memory.writeByte(this.offset,n)}}t.WindowYRegister=e,t.windowYRegister=new e},5425:(h,t)=>{function i(e,s){return e&~(1<<s)}function r(e){return 255&e}Object.defineProperty(t,"__esModule",{value:!0}),t.getUpperNibble=t.getLowerNibble=t.getMostSignificantByte=t.getLeastSignificantByte=t.convertUint8ToInt8=t.asUint16=t.asUint8=t.setBit=t.clearBit=t.getBit=void 0,t.getBit=function(e,s){return e>>s&1},t.clearBit=i,t.setBit=function(e,s,n){let d=i(e,s);return n===1&&(d|=1<<s),d},t.asUint8=r,t.asUint16=function(e){return 65535&e},t.convertUint8ToInt8=function(e){return r(e)<<24>>24},t.getLeastSignificantByte=function(e){return 255&e},t.getMostSignificantByte=function(e){return e>>8&255},t.getLowerNibble=function(e){return 15&e},t.getUpperNibble=function(e){return e>>4&15}},4311:(h,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EnhancedImageData=void 0;class i extends ImageData{setPixel(e,s,n,d,f,u=255){const c=s*this.width*4+4*e;this.data[c]=n,this.data[c+1]=d,this.data[c+2]=f,this.data[c+3]=u}}t.EnhancedImageData=i},2773:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.controllerManager=t.ControllerManager=t.Xbox360ControllerButtons=void 0;const r=i(7374);var e;(function(n){n[n.A=0]="A",n[n.B=1]="B",n[n.X=2]="X",n[n.Y=3]="Y",n[n.LeftBumper=4]="LeftBumper",n[n.RightBumper=5]="RightBumper",n[n.LeftTrigger=6]="LeftTrigger",n[n.RightTrigger=7]="RightTrigger",n[n.Select=8]="Select",n[n.Start=9]="Start",n[n.L3=10]="L3",n[n.R3=11]="R3",n[n.DpadUp=12]="DpadUp",n[n.DpadDown=13]="DpadDown",n[n.DpadLeft=14]="DpadLeft",n[n.DpadRight=15]="DpadRight"})(e=t.Xbox360ControllerButtons||(t.Xbox360ControllerButtons={}));class s{constructor(){this.controller=0,this.left=e.DpadLeft,this.right=e.DpadRight,this.up=e.DpadUp,this.down=e.DpadDown,this.select=e.Select,this.start=e.Start,this.b=e.X,this.a=e.A}queryButtons(){const d=navigator.getGamepads()[this.controller];d&&(r.input.isPressingLeft=d.buttons[this.left].pressed||d.axes[0]<-.1,r.input.isPressingRight=d.buttons[this.right].pressed||d.axes[0]>.1,r.input.isPressingUp=d.buttons[this.up].pressed||d.axes[1]<-.1,r.input.isPressingDown=d.buttons[this.down].pressed||d.axes[1]>.1,r.input.isPressingSelect=d.buttons[this.select].pressed,r.input.isPressingStart=d.buttons[this.start].pressed,r.input.isPressingB=d.buttons[this.b].pressed,r.input.isPressingA=d.buttons[this.a].pressed)}}t.ControllerManager=s,t.controllerManager=new s},7374:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.input=t.Input=void 0;const r=i(5425);class e{constructor(){this.isPressingUp=!1,this.isPressingDown=!1,this.isPressingLeft=!1,this.isPressingRight=!1,this.isPressingSelect=!1,this.isPressingStart=!1,this.isPressingA=!1,this.isPressingB=!1,this.isPollingDirections=!1,this.isPollingButtons=!1}setInputToCheck(n){this.isPollingButtons=(n>>4&1)==1,this.isPollingDirections=(n>>5&1)==1}reportInput(){let n=15;return this.isPollingDirections&&(n=r.setBit(n,0,this.isPressingRight?0:1),n=r.setBit(n,1,this.isPressingLeft?0:1),n=r.setBit(n,2,this.isPressingUp?0:1),n=r.setBit(n,3,this.isPressingDown?0:1)),this.isPollingButtons&&(n=r.setBit(n,0,this.isPressingA?0:1),n=r.setBit(n,1,this.isPressingB?0:1),n=r.setBit(n,2,this.isPressingSelect?0:1),n=r.setBit(n,3,this.isPressingStart?0:1)),n=r.setBit(n,4,this.isPollingButtons?0:1),n=r.setBit(n,5,this.isPollingDirections?0:1),n}}t.Input=e,t.input=new e},7202:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.keyboardManager=t.KeyboardManager=void 0;const r=i(7374);class e{constructor(){this.down="ArrowDown",this.up="ArrowUp",this.left="ArrowLeft",this.right="ArrowRight",this.a="KeyA",this.b="KeyB",this.start="Enter",this.select="ControlRight",document.addEventListener("keydown",n=>this.handleKeyEvent(n.code,!0)),document.addEventListener("keyup",n=>this.handleKeyEvent(n.code,!1))}handleKeyEvent(n,d){n===this.down&&(r.input.isPressingDown=d),n===this.up&&(r.input.isPressingUp=d),n===this.left&&(r.input.isPressingLeft=d),n===this.right&&(r.input.isPressingRight=d),n===this.a&&(r.input.isPressingA=d),n===this.b&&(r.input.isPressingB=d),n===this.start&&(r.input.isPressingStart=d),n===this.select&&(r.input.isPressingSelect=d)}}t.KeyboardManager=e,t.keyboardManager=new e},5281:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.controllerDataRegister=void 0;const r=i(8254);t.controllerDataRegister=new class{constructor(){this.offset=65280,this.name="P1"}get value(){return r.memory.readByte(this.offset)}get isPollingDirections(){return r.memory.readByte(this.offset)>>4&1}get isPollingButtons(){return r.memory.readByte(this.offset)>>5&1}}},3084:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dmaTransferController=void 0;const r=i(6685),e=i(8254),s=i(8078);class n{transfer(){const f=s.dmaTransferRegister.value*n.AddressInterval,u=r.objectAttributeMemoryRegisters.length*r.ObjectAttributeMemoryRegister.BytesPerRegister;for(let c=0;c<u;c++){const l=e.memory.readByte(f+c);e.memory.writeByte(r.ObjectAttributeMemoryRegister.StartOffset+c,l)}}}n.AddressInterval=256,t.dmaTransferController=new n},8254:(h,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.memory=t.Memory=void 0;const r=i(3084),e=i(7374),s=i(9080),n=i(8078),d=i(5281),f=new ArrayBuffer(65536),u=new DataView(f),c=new Uint8Array(f);class l{insertCartridge(S){this.cartridge=S}get memoryBytes(){return c}reset(){c.fill(0,0,c.length-1)}readByte(S){return m(S)?this.cartridge?this.cartridge.readByte(S):0:b(S)?e.input.reportInput():u.getUint8(S)}readSignedByte(S){return m(S)?this.cartridge?this.cartridge.readSignedByte(S):0:u.getInt8(S)}readWord(S){return m(S)?this.cartridge?this.cartridge.readWord(S):0:u.getUint16(S,!0)}writeByte(S,k){var x;m(S)?(x=this.cartridge)==null||x.writeByte(S,k):b(S)?e.input.setInputToCheck(k):(S===s.dividerRegister.offset&&u.setUint8(s.dividerRegister.offset,0),u.setUint8(S,k),function(F){return F===n.dmaTransferRegister.offset}(S)&&r.dmaTransferController.transfer())}writeWord(S,k){var x;m(S)?(x=this.cartridge)==null||x.writeWord(S,k):u.setUint16(S,k,!0)}}function m(A){return A<=32767||A>=40960&&A<=49151}function b(A){return A===d.controllerDataRegister.offset}t.Memory=l,t.memory=new l}},g={};function v(h){if(g[h])return g[h].exports;var t=g[h]={exports:{}};return y[h].call(t.exports,t,t.exports,v),t.exports}v.d=(h,t)=>{for(var i in t)v.o(t,i)&&!v.o(h,i)&&Object.defineProperty(h,i,{enumerable:!0,get:t[i]})},v.o=(h,t)=>Object.prototype.hasOwnProperty.call(h,t),v.r=h=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(h,"__esModule",{value:!0})};var p={};return(()=>{var h=p;Object.defineProperty(h,"__esModule",{value:!0}),h.Gameboy=void 0;const t=v(1007),i=v(9145),r=v(8254),e=v(7374),s=v(5991),n=v(8224),d=v(2773),f=v(3426),u=v(7189),c=v(7202);h.Gameboy=class{constructor(){this.cpu=new i.CPU,this.gpu=new t.GPU,this.apu=new s.APU,this.memory=r.memory,this.fps=0,this.input=e.input,this.controllerManager=d.controllerManager,this.keyboardManager=c.keyboardManager,this.maxFps=60,this.interval=1e3/this.maxFps,this.cycles=0,this.previousTime=0}run(){this.cpu.initialize(),r.memory.reset(),n.lcdControlRegister.value=131,requestAnimationFrame(l=>this.runFrame(l))}runFrame(l){const m=l-this.previousTime;if(m>=this.interval||!this.previousTime){for(this.fps=1e3/(l-this.previousTime),this.previousTime=l-m%this.interval;this.cycles<=t.GPU.CyclesPerFrame;){const b=this.cpu.tick();this.gpu.tick(b),this.apu.tick(b),this.cycles+=b}d.controllerManager.queryButtons(),this.frameFinishedCallback&&this.frameFinishedCallback(this.gpu.screen,this.fps,this.cpu.registers),this.cycles=this.cycles%t.GPU.CyclesPerFrame}requestAnimationFrame(b=>this.runFrame(b))}onFrameFinished(l){this.frameFinishedCallback=l}loadGame(l){const m=u.CartridgeLoader.FromArrayBuffer(l);r.memory.insertCartridge(m),console.log("title: "+m.title),console.log("version: "+m.versionNumber),console.log("type: "+m.typeName),console.log("rom size: "+m.romSize),console.log("ram size: "+m.ramSize)}setCartridgeSaveRam(l){var m;(((m=r.memory.cartridge)==null?void 0:m.type)===f.CartridgeType.MBC1_RAM_BATTERY||f.CartridgeType.MBC3_RAM_BATTERY)&&r.memory.cartridge.setRam(l)}getCartridgeSaveRam(){var l;if(((l=r.memory.cartridge)==null?void 0:l.type)===f.CartridgeType.MBC1_RAM_BATTERY||f.CartridgeType.MBC3_RAM_BATTERY)return r.memory.cartridge.dumpRam()}setOnWriteToCartridgeRam(l){var m;(((m=r.memory.cartridge)==null?void 0:m.type)===f.CartridgeType.MBC1_RAM_BATTERY||f.CartridgeType.MBC3_RAM_BATTERY)&&(r.memory.cartridge.onSramWrite=l)}get cartridge(){return r.memory.cartridge}}})(),p})()})})(Tt);function Ai({game:o}){const a=new Tt.exports.Gameboy,y=Ke.exports.useRef(null);return Ke.exports.useEffect(function(){fetch(o.executable).then(g=>g.arrayBuffer()).then(g=>{a.loadGame(g),a.apu.enableSound();const v=y.current.getContext("2d");a.onFrameFinished(p=>v==null?void 0:v.putImageData(p,0,0)),a.run()})},[o.hash]),ge("canvas",{width:"160",height:"144",ref:y,style:{width:"100vw",imageRendering:"pixelated"}})}function Pi(){const{game:o,hash:a}=wi.parse(location.search.substring(1)),y=et(atob(o.toString()),36)===a,g=JSON.parse(atob(o.toString())),v=g.executable.split(".").pop(),p={...g,id:et(g.name).toString(),hash:a==null?void 0:a.toString(),signed:y.toString(),ext:v};return p.type==="GAMEBOY"?ge(Ai,{game:p}):ge("pre",{children:ge("code",{children:JSON.stringify(p,null,4)})})}Et(document.getElementById("runner-root")).render(ge(Pi,{}));
